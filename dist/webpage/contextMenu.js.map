{"version":3,"sources":["../../src/webpage/contextMenu.ts"],"sourcesContent":["/*this is a modified version from jank client*/\n\ntype iconJson =\n\t| {\n\t\t\tsrc: string;\n\t  }\n\t| {\n\t\t\tcss: string;\n\t  }\n\t| {\n\t\t\thtml: HTMLElement;\n\t  };\ninterface menuPart<x, y> {\n\tmakeContextHTML(obj1: x, obj2: y, menu: HTMLDivElement): void;\n}\n\nclass ContextButton<x, y> implements menuPart<x, y> {\n\tprivate text: string | (() => string);\n\tprivate onClick: (this: x, arg: y, e: MouseEvent) => void;\n\tprivate icon?: iconJson;\n\tprivate visable?: (this: x, arg: y) => boolean;\n\tprivate enabled?: (this: x, arg: y) => boolean;\n\t//TODO there *will* be more colors\n\tprivate color?: \"red\" | \"blue\";\n\tconstructor(\n\t\ttext: ContextButton<x, y>[\"text\"],\n\t\tonClick: ContextButton<x, y>[\"onClick\"],\n\t\taddProps: {\n\t\t\ticon?: iconJson;\n\t\t\tvisable?: (this: x, arg: y) => boolean;\n\t\t\tenabled?: (this: x, arg: y) => boolean;\n\t\t\tcolor?: \"red\" | \"blue\";\n\t\t} = {},\n\t) {\n\t\tthis.text = text;\n\t\tthis.onClick = onClick;\n\t\tthis.icon = addProps.icon;\n\t\tthis.visable = addProps.visable;\n\t\tthis.enabled = addProps.enabled;\n\t\tthis.color = addProps.color;\n\t}\n\tisVisable(obj1: x, obj2: y): boolean {\n\t\tif (!this.visable) return true;\n\t\treturn this.visable.call(obj1, obj2);\n\t}\n\tmakeContextHTML(obj1: x, obj2: y, menu: HTMLDivElement) {\n\t\tif (!this.isVisable(obj1, obj2)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst intext = document.createElement(\"button\");\n\t\tintext.classList.add(\"contextbutton\");\n\t\tintext.append(this.textContent);\n\n\t\tintext.disabled = !!this.enabled && !this.enabled.call(obj1, obj2);\n\n\t\tif (this.icon) {\n\t\t\tif (\"src\" in this.icon) {\n\t\t\t\tconst icon = document.createElement(\"img\");\n\t\t\t\ticon.classList.add(\"svgicon\");\n\t\t\t\ticon.src = this.icon.src;\n\t\t\t\tintext.append(icon);\n\t\t\t} else if (\"css\" in this.icon) {\n\t\t\t\tconst icon = document.createElement(\"span\");\n\t\t\t\ticon.classList.add(this.icon.css, \"svgicon\");\n\t\t\t\tswitch (this.color) {\n\t\t\t\t\tcase \"red\":\n\t\t\t\t\t\ticon.style.background = \"var(--red)\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"blue\":\n\t\t\t\t\t\ticon.style.background = \"var(--blue)\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tintext.append(icon);\n\t\t\t} else {\n\t\t\t\tintext.append(this.icon.html);\n\t\t\t}\n\t\t}\n\n\t\tswitch (this.color) {\n\t\t\tcase \"red\":\n\t\t\t\tintext.style.color = \"var(--red)\";\n\t\t\t\tbreak;\n\t\t\tcase \"blue\":\n\t\t\t\tintext.style.color = \"var(--blue)\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tintext.onclick = (e) => {\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t\tmenu.remove();\n\t\t\tthis.onClick.call(obj1, obj2, e);\n\t\t};\n\n\t\tmenu.append(intext);\n\t}\n\tget textContent() {\n\t\tif (this.text instanceof Function) {\n\t\t\treturn this.text();\n\t\t}\n\t\treturn this.text;\n\t}\n}\nclass Seperator<x, y> implements menuPart<x, y> {\n\tprivate visable?: (obj1: x, obj2: y) => boolean;\n\tconstructor(visable?: (obj1: x, obj2: y) => boolean) {\n\t\tthis.visable = visable;\n\t}\n\tmakeContextHTML(obj1: x, obj2: y, menu: HTMLDivElement): void {\n\t\tif (!this.visable || this.visable(obj1, obj2)) {\n\t\t\tif (menu.children[menu.children.length - 1].tagName === \"HR\") {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tmenu.append(document.createElement(\"hr\"));\n\t\t}\n\t}\n}\nclass Contextmenu<x, y> {\n\tstatic currentmenu: HTMLElement | \"\";\n\tname: string;\n\tbuttons: menuPart<x, y>[];\n\tdiv!: HTMLDivElement;\n\tstatic setup() {\n\t\tContextmenu.currentmenu = \"\";\n\t\tdocument.addEventListener(\"click\", (event) => {\n\t\t\tif (Contextmenu.currentmenu === \"\") {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!Contextmenu.currentmenu.contains(event.target as Node)) {\n\t\t\t\tContextmenu.currentmenu.remove();\n\t\t\t\tContextmenu.currentmenu = \"\";\n\t\t\t}\n\t\t});\n\t}\n\tconstructor(name: string) {\n\t\tthis.name = name;\n\t\tthis.buttons = [];\n\t}\n\n\taddButton(\n\t\ttext: ContextButton<x, y>[\"text\"],\n\t\tonClick: ContextButton<x, y>[\"onClick\"],\n\t\taddProps: {\n\t\t\ticon?: iconJson;\n\t\t\tvisable?: (this: x, arg: y) => boolean;\n\t\t\tenabled?: (this: x, arg: y) => boolean;\n\t\t\tcolor?: \"red\" | \"blue\";\n\t\t} = {},\n\t) {\n\t\tthis.buttons.push(new ContextButton(text, onClick, addProps));\n\t}\n\taddSeperator(visable?: (obj1: x, obj2: y) => boolean) {\n\t\tthis.buttons.push(new Seperator(visable));\n\t}\n\tprivate makemenu(x: number, y: number, addinfo: x, other: y) {\n\t\tconst div = document.createElement(\"div\");\n\t\tdiv.classList.add(\"contextmenu\", \"flexttb\");\n\n\t\tfor (const button of this.buttons) {\n\t\t\tbutton.makeContextHTML(addinfo, other, div);\n\t\t}\n\t\tif (div.children[div.children.length - 1].tagName === \"HR\") {\n\t\t\tdiv.children[div.children.length - 1].remove();\n\t\t}\n\t\t//NOTE I don't know if this'll ever actually happen in reality\n\t\tif (div.childNodes.length === 0) return;\n\n\t\tif (Contextmenu.currentmenu !== \"\") {\n\t\t\tContextmenu.currentmenu.remove();\n\t\t}\n\t\tdiv.style.top = y + \"px\";\n\t\tdiv.style.left = x + \"px\";\n\t\tdocument.body.appendChild(div);\n\t\tContextmenu.keepOnScreen(div);\n\t\tContextmenu.currentmenu = div;\n\t\treturn this.div;\n\t}\n\tbindContextmenu(obj: HTMLElement, addinfo: x, other: y, sub = false) {\n\t\tconst func = (event: MouseEvent) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\tlet x = event.clientX;\n\t\t\tlet y = event.clientY;\n\t\t\tif (sub) {\n\t\t\t\tconst box = obj.getBoundingClientRect();\n\t\t\t\tx = box.left;\n\t\t\t\ty = box.bottom;\n\t\t\t}\n\t\t\tthis.makemenu(x, y, addinfo, other);\n\t\t};\n\t\tobj.addEventListener(sub?\"click\":\"contextmenu\", func);\n\t\treturn func;\n\t}\n\tstatic keepOnScreen(obj: HTMLElement) {\n\t\tconst html = document.documentElement.getBoundingClientRect();\n\t\tconst docheight = html.height;\n\t\tconst docwidth = html.width;\n\t\tconst box = obj.getBoundingClientRect();\n\t\tconsole.log(box, docheight, docwidth);\n\t\tif (box.right > docwidth) {\n\t\t\tconsole.log(\"test\");\n\t\t\tobj.style.left = docwidth - box.width + \"px\";\n\t\t}\n\t\tif (box.bottom > docheight) {\n\t\t\tobj.style.top = docheight - box.height + \"px\";\n\t\t}\n\t}\n}\nContextmenu.setup();\nexport {Contextmenu};\n"],"names":["ContextButton","text","onClick","icon","visable","enabled","color","constructor","addProps","isVisable","obj1","obj2","call","makeContextHTML","menu","intext","document","createElement","classList","add","append","textContent","disabled","src","css","style","background","html","onclick","e","preventDefault","stopImmediatePropagation","remove","Function","Seperator","children","length","tagName","Contextmenu","currentmenu","name","buttons","div","setup","addEventListener","event","contains","target","addButton","push","addSeperator","makemenu","x","y","addinfo","other","button","childNodes","top","left","body","appendChild","keepOnScreen","bindContextmenu","obj","sub","func","clientX","clientY","box","getBoundingClientRect","bottom","documentElement","docheight","height","docwidth","width","console","log","right"],"mappings":"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"}