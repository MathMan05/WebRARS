{"version":3,"sources":["../../../src/webpage/editor/editor.ts"],"sourcesContent":["import {assemble, AssemblError} from \"../assembler/assembler.js\";\nimport {Console} from \"../emulator/console.js\";\nimport {Symstem} from \"../emulator/emulator.js\";\nimport {I18n} from \"../i18n.js\";\nimport {Directory} from \"../utils/utils.js\";\nimport {Line} from \"./line.js\";\ninterface StateEventMap {\n\tAssemble: AssembleEvent;\n\tchanged: Event;\n\tsave: Event;\n}\ntype cursor =\n\t| {\n\t\t\tpossitions: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[];\n\t  }\n\t| {\n\t\t\thighlights: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[];\n\t  };\nconst redispatched = new WeakSet();\nwindow.addEventListener(\"paste\", (event) => {\n\tif (redispatched.has(event)) {\n\t\treturn;\n\t}\n\tconst e = new ClipboardEvent(\"paste\", event);\n\tredispatched.add(e);\n\tif (document.activeElement) {\n\t\tdocument.activeElement.dispatchEvent(e);\n\t}\n});\nclass Editor extends EventTarget {\n\tlines: Line[];\n\ttabLength = 8;\n\tcursor: cursor = {\n\t\tpossitions: [\n\t\t\t{\n\t\t\t\tline: 1,\n\t\t\t\tindex: 0,\n\t\t\t},\n\t\t],\n\t};\n\tscroll = {\n\t\tlinedown: 0,\n\t\tcharleft: 0,\n\t};\n\tconsole: Console;\n\tfileName: string;\n\tfileDir?: string;\n\tfontSize = 14;\n\tpast: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tfuture: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tdir: Directory | undefined;\n\tconstructor(asm: string, fileName = \"name\", console: Console, proj: Directory | undefined) {\n\t\tsuper();\n\t\tthis.console = console;\n\t\tthis.lines = asm.split(\"\\n\").map((_) => new Line(_, this));\n\t\tif (this.lines.length === 0) {\n\t\t\tthis.lines.push(new Line(\"\", this));\n\t\t}\n\t\tthis.fileName = fileName;\n\t\tthis.dir = proj;\n\t}\n\taddEventListener<K extends keyof StateEventMap>(\n\t\ttype: K,\n\t\tlistener: (ev: StateEventMap[K]) => void,\n\t\toptions?: boolean | AddEventListenerOptions,\n\t) {\n\t\t//@ts-expect-error\n\t\tsuper.addEventListener(type, listener, options);\n\t}\n\theight = 18;\n\tcharWidth = 18;\n\trenderToCanvas(ctx: CanvasRenderingContext2D) {\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tconst fontSize = this.fontSize;\n\t\tconst height = Math.floor(ctx.canvas.height / this.fontSize);\n\t\tthis.height = height;\n\t\tctx.font = `${fontSize}px monospace`;\n\t\tconst charWidth = ctx.measureText(\"a\").width;\n\t\tthis.charWidth = charWidth;\n\t\tctx.textBaseline = \"hanging\";\n\t\tconst linedown = Math.floor(this.scroll.linedown);\n\t\tconst widthNeeded = this.widthNeeded();\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (line && line.errored) {\n\t\t\t\tctx.fillStyle = \"lemonchiffon\";\n\t\t\t\tconst y = (i - linedown) * fontSize;\n\t\t\t\tctx.fillRect(widthNeeded + 10, y, ctx.canvas.width, this.fontSize);\n\t\t\t}\n\t\t}\n\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tctx.fillStyle = \"LightBlue\";\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const high of this.cursor.highlights) {\n\t\t\t\tconst h = getStart(high.start, high.end);\n\t\t\t\tif (h[0].line >= height + linedown || h[1].line < linedown) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = h[0].line; i <= h[1].line && i < height + linedown; i++) {\n\t\t\t\t\tlet startx: number;\n\t\t\t\t\tlet endx: number;\n\t\t\t\t\tif (h[0].line === i) {\n\t\t\t\t\t\tstartx = widthNeeded + 10 + h[0].index * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartx = widthNeeded + 10;\n\t\t\t\t\t}\n\t\t\t\t\tconst endline = this.lines[i];\n\t\t\t\t\tif (h[1].line === i) {\n\t\t\t\t\t\tendx = widthNeeded + 10 + endline.moveCursor(h[1].index, 0) * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendx = widthNeeded + 10 + endline.length() * charWidth;\n\t\t\t\t\t}\n\t\t\t\t\tendx -= startx;\n\t\t\t\t\tconst y = (i - linedown) * fontSize;\n\t\t\t\t\tctx.fillRect(startx, y, endx, fontSize);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (!line) break;\n\t\t\tconst y = (i - linedown) * fontSize;\n\n\t\t\tlet cursors: number[] = [];\n\t\t\tif ((this.blinkOffset + Date.now()) % this.blinkInterval < this.blinkInterval / 2) {\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tcursors = this.cursor.possitions.filter((_) => _.line === i).map((_) => _.index);\n\t\t\t\t} else {\n\t\t\t\t\tcursors = this.cursor.highlights.filter((_) => _.end.line === i).map((_) => _.end.index);\n\t\t\t\t}\n\t\t\t}\n\t\t\tline.drawLine(ctx, widthNeeded + 10, y, charWidth, cursors);\n\t\t\tctx.fillStyle = \"grey\";\n\t\t\tctx.fillRect(widthNeeded + 5, y, 1, fontSize);\n\t\t\tctx.fillStyle = \"black\";\n\t\t\tctx.fillText(`${i + 1}`, 4, y);\n\t\t}\n\t}\n\twidthNeeded() {\n\t\treturn this.charWidth * Math.floor(Math.log(Math.max(this.lines.length, 33)));\n\t}\n\tblinkInterval = 800;\n\tblinkOffset = 0;\n\tfocusCursors() {\n\t\tthis.blinkOffset = -Date.now() % this.blinkInterval;\n\t}\n\tcollectCurors() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tthis.cursor.possitions.sort((a, b) => {\n\t\t\t\tif (a.line < b.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (a.line > b.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn +(a.index < b.index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.cursor.possitions = this.cursor.possitions.filter((a, i, array) => {\n\t\t\t\tif (i === 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn a.index !== array[i - 1].index || a.line !== array[i - 1].line;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tgetState() {\n\t\treturn {lines: this.lines, cursor: structuredClone(this.cursor)};\n\t}\n\tpushPast() {\n\t\tthis.past.push(this.getState());\n\t\tthis.future = [];\n\t}\n\tstring() {\n\t\treturn this.lines.map((_) => _.str).join(\"\\n\");\n\t}\n\tcastToHighlights() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tconst arr: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[] = [];\n\t\t\tfor (const pos of this.cursor.possitions) {\n\t\t\t\tarr.push({\n\t\t\t\t\tstart: pos,\n\t\t\t\t\tend: structuredClone(pos),\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.cursor = {highlights: arr};\n\t\t}\n\t}\n\tsortHighlights() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor.highlights.sort((a, b) => {\n\t\t\t\tconst [sa] = getStart(a.end, a.start);\n\t\t\t\tconst [sb] = getStart(b.end, b.start);\n\t\t\t\tif (sa.line < sb.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (sa.line > sb.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (sa.index < sb.index) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet prev = getStart(this.cursor.highlights[0].end, this.cursor.highlights[0].start);\n\n\t\t\tlet first = true;\n\t\t\tconst cursor: cursor = {highlights: []};\n\t\t\tcursor.highlights.push(this.cursor.highlights[0]);\n\t\t\tfor (const pos of this.cursor.highlights) {\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst cur = getStart(pos.end, pos.start);\n\t\t\t\tif (\n\t\t\t\t\tcur[0].line < prev[1].line ||\n\t\t\t\t\t(cur[0].line == prev[1].line && cur[0].index < prev[1].index)\n\t\t\t\t) {\n\t\t\t\t\tprev[1].line = cur[1].line;\n\t\t\t\t\tprev[1].index = cur[1].index;\n\t\t\t\t} else {\n\t\t\t\t\tcursor.highlights.push(pos);\n\t\t\t\t\tprev = cur;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor = cursor;\n\t\t}\n\t}\n\tcastToCursorsPassive() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.cursor = {\n\t\t\t\tpossitions: this.cursor.highlights.map((_) => _.end),\n\t\t\t};\n\t\t}\n\t}\n\tgiveError(e: AssemblError) {\n\t\tthis.lines[e.line].error();\n\t}\n\tcastToCursorsDestructive() {\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.sortHighlights();\n\t\t\tconst arr: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[] = [];\n\t\t\tlet i = 0;\n\t\t\tlet h:\n\t\t\t\t| {\n\t\t\t\t\t\tline: number;\n\t\t\t\t\t\tindex: number;\n\t\t\t\t  }[]\n\t\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\tlet realLineIndex = 0;\n\t\t\tconst lines: Line[] = [];\n\t\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\t\tconst line = this.lines[j];\n\t\t\t\tif (h && j >= h[0].line) {\n\t\t\t\t\tlet destroyed = false;\n\t\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\t\tdestroyed = true;\n\t\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t\tconst dline = line.deleteRanges(highlights);\n\t\t\t\t\tlet newLine: Line = dline.line;\n\t\t\t\t\tlet offset = 0;\n\t\t\t\t\tif (destroyed) {\n\t\t\t\t\t\tconst pop = lines.pop();\n\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\toffset = pop.str.length;\n\t\t\t\t\t\t\tnewLine = new Line(pop.str + dline.line.str, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trealLineIndex++;\n\t\t\t\t\t}\n\t\t\t\t\tlines.push(newLine);\n\t\t\t\t\tfor (const thing of dline.fakeCurors) {\n\t\t\t\t\t\tconst i = thing + offset;\n\t\t\t\t\t\tarr.push({\n\t\t\t\t\t\t\tline: realLineIndex - 1,\n\t\t\t\t\t\t\tindex: newLine.getFakeIndex(i),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (h) {\n\t\t\t\t\t\tif (h[1].line === j) {\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tj = h[1].line - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\trealLineIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\tthis.lines = lines;\n\t\t\tthis.cursor = {possitions: arr};\n\t\t\tthis.collectCurors();\n\t\t}\n\t}\n\tsave() {\n\t\tthis.dispatchEvent(new Event(\"save\"));\n\t}\n\tshiftArrow(e: KeyboardEvent) {\n\t\tthis.castToHighlights();\n\t\tif (!(\"highlights\" in this.cursor)) throw Error(\"this will never happen :3\");\n\t\tswitch (e.key) {\n\t\t\tcase \"ArrowRight\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowLeft\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowDown\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\tif (this.lines.length === cursor.end.line) {\n\t\t\t\t\t\tcursor.end.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowUp\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\tif (cursor.end.line === -1) {\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.sortHighlights();\n\t}\n\tcopy() {\n\t\tif (!(\"highlights\" in this.cursor)) {\n\t\t\tconsole.warn(\"copying for regular cursors is not implemented\");\n\t\t\treturn [];\n\t\t}\n\t\tthis.sortHighlights();\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\n\t\tlet i = 0;\n\t\tlet h:\n\t\t\t| {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t  }[]\n\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\tconst strings: string[] = [];\n\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\tconst line = this.lines[j];\n\t\t\tif (h && j >= h[0].line) {\n\t\t\t\tif (h[0].line < j && h[1].line > j) {\n\t\t\t\t\tstrings.push(this.lines[j].str);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t}\n\t\t\t\tconst dline = line.getRanges(highlights);\n\t\t\t\tstrings.push(...dline);\n\t\t\t}\n\t\t}\n\t\treturn strings;\n\t}\n\townCanvas(c: HTMLCanvasElement) {\n\t\tlet lastClicked = 0;\n\t\tconst ctx = c.getContext(\"2d\");\n\t\tif (!ctx) throw Error(\"Unable to get canvas context 2d\");\n\t\tconst mut = new ResizeObserver((e) => {\n\t\t\tfor (const _ of e) {\n\t\t\t}\n\t\t\tconst box = c.parentElement!.getBoundingClientRect();\n\t\t\tc.width = box.width;\n\t\t\tc.height = box.height;\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.scroll.linedown += (e.deltaY / 400) * this.height;\n\t\t\t\tthis.scroll.linedown = Math.min(\n\t\t\t\t\tthis.scroll.linedown,\n\t\t\t\t\tthis.lines.length - c.height / this.fontSize + 1,\n\t\t\t\t);\n\t\t\t\tthis.scroll.linedown = Math.max(this.scroll.linedown, 0);\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t},\n\t\t\t{passive: false},\n\t\t);\n\n\t\tc.contentEditable = \"true\";\n\n\t\tc.addEventListener(\"paste\", (event) => {\n\t\t\tthis.castToCursorsDestructive();\n\t\t\tthis.collectCurors();\n\t\t\tconsole.log(\"paste\");\n\t\t\tevent.preventDefault();\n\t\t\tif (!event.clipboardData) return;\n\t\t\tconst paste = event.clipboardData.getData(\"text\");\n\t\t\tconsole.log(paste);\n\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\tlet newI = 0;\n\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\tconst replace = this.lines[i].paste(\n\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\tpaste,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\tnewI++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = newLines;\n\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"keydown\", (e) => {\n\t\t\tthis.collectCurors();\n\t\t\tif (e.key.toLowerCase() === \"v\" && e.ctrlKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"z\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.past.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.future.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"y\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.future.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.past.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\tif (e.key.startsWith(\"Arrow\")) {\n\t\t\t\tif (!e.shiftKey) {\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t\tif (!(\"possitions\" in this.cursor))\n\t\t\t\t\t\tthrow new Error(\"was just cast, should be possitions\");\n\t\t\t\t\tswitch (e.key) {\n\t\t\t\t\t\tcase \"ArrowLeft\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[cursor.line].length();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowRight\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowDown\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\tif (this.lines.length === cursor.line) {\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowUp\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\tif (cursor.line === -1) {\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.shiftArrow(e);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.length === 1 || e.key === \"Backspace\" || e.key === \"Enter\" || e.key === \"Tab\") &&\n\t\t\t\t!e.metaKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.ctrlKey\n\t\t\t) {\n\t\t\t\tif (\"highlights\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t\tif (e.key === \"Backspace\") {\n\t\t\t\t\t\tthis.focusCursors();\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet key = e.key;\n\t\t\t\tif (key === \"Tab\") {\n\t\t\t\t\tkey = \"\t\";\n\t\t\t\t}\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\t\tlet newI = 0;\n\t\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\t\tconst replace = this.lines[i].insert(\n\t\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (replace.orphaned) {\n\t\t\t\t\t\t\t\tlet pop = newLines.pop();\n\t\t\t\t\t\t\t\tlet line: Line;\n\t\t\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\t\t\tline = new Line(pop.str + replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tline = new Line(replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tpop = line;\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (const thing of replace.orphaned.cursors) {\n\t\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\t\tline: newI - 1,\n\t\t\t\t\t\t\t\t\t\tindex: line.getFakeIndex(Math.max(thing, 0) + pop.str.length),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\t\tthis.lines = newLines;\n\t\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.toLowerCase() === \"c\" || e.key.toLowerCase() === \"x\") &&\n\t\t\t\te.ctrlKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.metaKey\n\t\t\t) {\n\t\t\t\tnavigator.clipboard.writeText(this.copy().join(\"\\n\"));\n\t\t\t\tif (e.key === \"x\") {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t}\n\t\t\t} else if (e.key.toLowerCase() === \"a\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tconsole.log(\"not here?\");\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t} else {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: {index: 0, line: 0},\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tindex: this.lines[this.lines.length - 1].length(),\n\t\t\t\t\t\t\t\t\tline: this.lines.length - 1,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (e.key === \"a\" && !e.ctrlKey && e.altKey && !e.metaKey) {\n\t\t\t\tthis.assemble();\n\t\t\t} else if (e.key === \"Backspace\" && e.ctrlKey) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tif (\"highlight\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tthis.castToHighlights();\n\t\t\t\tif (\"possitions\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, -2);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t} else if (e.key === \"s\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tlet dragged: undefined | {line: number; index: number} = undefined;\n\t\tc.addEventListener(\"mousedown\", (e) => {\n\t\t\te.preventDefault();\n\t\t\tthis.focusCursors();\n\t\t\tc.focus();\n\t\t\tif (e.button === 0) {\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tdragged = {line: linePos, index: curse};\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tlet start;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tstart = this.cursor.possitions[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart = this.cursor.highlights[0].start;\n\t\t\t\t\t}\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//TODO make this a setting\n\t\t\t\tif (Date.now() < lastClicked + 300) {\n\t\t\t\t\tdragged = undefined;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tlastClicked = Date.now();\n\t\t\t\t\t\tconst bounds = line.getWordBounds(curse);\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: bounds[0]},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: bounds[1]},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: 0},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: line.length()},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlastClicked = Date.now();\n\t\t\t\tconst cursor = {line: linePos, index: curse};\n\t\t\t\tif (!e.altKey) {\n\t\t\t\t\tthis.cursor = {possitions: [cursor]};\n\t\t\t\t} else {\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tthis.cursor.possitions.push(cursor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor.highlights.push({\n\t\t\t\t\t\t\tstart: cursor,\n\t\t\t\t\t\t\tend: structuredClone(cursor),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.collectCurors();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"mouseup\", () => {\n\t\t\tdragged = undefined;\n\t\t});\n\t\tc.addEventListener(\"mousemove\", (e) => {\n\t\t\tif (dragged) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tif (linePos !== dragged.line && dragged.index !== curse) {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: dragged,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsetInterval(() => {\n\t\t\tthis.renderToCanvas(ctx);\n\t\t}, this.blinkInterval / 2);\n\t\tmut.observe(c);\n\t\tthis.renderToCanvas(ctx);\n\t}\n\tasync assemble() {\n\t\t//TODO I'm sure there's more I can do to make this much smaller in RAM\n\t\ttry {\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.startingAssembly() + \"\\n\\n\");\n\t\t\tlet emu: Symstem;\n\t\t\tif (this.dir && this.fileDir) {\n\t\t\t\tconst dirL = this.fileDir.split(\"/\");\n\t\t\t\tdirL.pop();\n\t\t\t\tconst dir = dirL.join(\"/\") + \"/\";\n\t\t\t\tconst build: [string, string][] = [[this.string(), this.fileDir]];\n\t\t\t\tfor await (const [name, thing] of this.dir.getAllInDir()) {\n\t\t\t\t\tif (thing instanceof Directory) continue;\n\t\t\t\t\tif (!name.endsWith(\".asm\")) continue;\n\t\t\t\t\tconst thisDir = dir + name;\n\t\t\t\t\tif (thisDir === this.fileDir) continue;\n\t\t\t\t\tbuild.push([await thing.text(), thisDir]);\n\t\t\t\t}\n\t\t\t\tconst [ram, pc] = assemble(build);\n\t\t\t\temu = new Symstem(ram, this.console);\n\t\t\t\temu.pc = pc;\n\t\t\t} else {\n\t\t\t\tconst [ram, pc] = assemble([[this.string(), this.fileDir || this.fileName]]);\n\t\t\t\temu = new Symstem(ram, this.console);\n\t\t\t\temu.pc = pc;\n\t\t\t}\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.finishedAssembly() + \"\\n\\n\");\n\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", emu));\n\t\t} catch (e) {\n\t\t\tif (e instanceof AssemblError) {\n\t\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", e));\n\t\t\t} else {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\tcreateEditor(): HTMLDivElement {\n\t\tconst area = document.createElement(\"div\");\n\t\tarea.classList.add(\"flexttb\", \"editor\");\n\t\tconst c = document.createElement(\"canvas\");\n\t\tarea.append(c);\n\t\tthis.ownCanvas(c);\n\t\treturn area;\n\t}\n}\nclass AssembleEvent extends Event {\n\tsys: Symstem | AssemblError;\n\tconstructor(code: string, sys: Symstem | AssemblError) {\n\t\tsuper(code);\n\t\tthis.sys = sys;\n\t}\n}\nexport {Editor, AssembleEvent};\n"],"names":["assemble","AssemblError","Symstem","I18n","Directory","Line","redispatched","WeakSet","window","addEventListener","event","has","e","ClipboardEvent","add","document","activeElement","dispatchEvent","Editor","EventTarget","lines","tabLength","cursor","possitions","line","index","scroll","linedown","charleft","console","fileName","fileDir","fontSize","past","future","dir","constructor","asm","proj","split","map","_","length","push","type","listener","options","height","charWidth","renderToCanvas","ctx","clearRect","canvas","width","Math","floor","font","measureText","textBaseline","widthNeeded","i","errored","fillStyle","y","fillRect","getStart","o1","o2","high","highlights","h","start","end","startx","endx","endline","moveCursor","cursors","blinkOffset","Date","now","blinkInterval","filter","drawLine","fillText","log","max","focusCursors","collectCurors","sort","a","b","array","getState","structuredClone","pushPast","string","str","join","castToHighlights","arr","pos","sortHighlights","sa","sb","prev","first","cur","castToCursorsPassive","giveError","error","castToCursorsDestructive","realLineIndex","j","destroyed","undefined","dline","deleteRanges","newLine","offset","pop","thing","fakeCurors","getFakeIndex","Event","save","shiftArrow","Error","key","out","ctrlKey","Infinity","min","copy","warn","strings","getRanges","ownCanvas","c","lastClicked","getContext","mut","ResizeObserver","box","parentElement","getBoundingClientRect","preventDefault","deltaY","passive","contentEditable","clipboardData","paste","getData","Set","newLines","newI","replace","toLowerCase","altKey","metaKey","startsWith","shiftKey","insert","orphaned","text","navigator","clipboard","writeText","dragged","focus","button","linePos","offsetY","curse","round","offsetX","bounds","getWordBounds","setInterval","observe","addMessage","startingAssembly","emu","dirL","build","name","getAllInDir","endsWith","thisDir","ram","pc","finishedAssembly","AssembleEvent","createEditor","area","createElement","classList","append","sys","code"],"mappings":"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"}