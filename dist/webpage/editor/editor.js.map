{"version":3,"sources":["../../../src/webpage/editor/editor.ts"],"sourcesContent":["import {assemble, AssemblError} from \"../assembler/assembler.js\";\nimport {Console} from \"../emulator/console.js\";\nimport {Symstem} from \"../emulator/emulator.js\";\nimport {I18n} from \"../i18n.js\";\nimport {Line} from \"./line.js\";\ninterface StateEventMap {\n\tAssemble: AssembleEvent;\n\tchanged: Event;\n\tsave: Event;\n}\ntype cursor =\n\t| {\n\t\t\tpossitions: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[];\n\t  }\n\t| {\n\t\t\thighlights: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[];\n\t  };\nconst redispatched = new WeakSet();\nwindow.addEventListener(\"paste\", (event) => {\n\tif (redispatched.has(event)) {\n\t\treturn;\n\t}\n\tconst e = new ClipboardEvent(\"paste\", event);\n\tredispatched.add(e);\n\tif (document.activeElement) {\n\t\tdocument.activeElement.dispatchEvent(e);\n\t}\n});\nclass Editor extends EventTarget {\n\tlines: Line[];\n\ttabLength = 8;\n\tcursor: cursor = {\n\t\tpossitions: [\n\t\t\t{\n\t\t\t\tline: 1,\n\t\t\t\tindex: 0,\n\t\t\t},\n\t\t],\n\t};\n\tscroll = {\n\t\tlinedown: 0,\n\t\tcharleft: 0,\n\t};\n\tconsole: Console;\n\tfileName: string;\n\tfontSize = 14;\n\tpast: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tfuture: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tconstructor(asm: string, fileName = \"name\", console: Console) {\n\t\tsuper();\n\t\tthis.console = console;\n\t\tthis.lines = asm.split(\"\\n\").map((_) => new Line(_, this));\n\t\tif (this.lines.length === 0) {\n\t\t\tthis.lines.push(new Line(\"\", this));\n\t\t}\n\t\tthis.fileName = fileName;\n\t}\n\taddEventListener<K extends keyof StateEventMap>(\n\t\ttype: K,\n\t\tlistener: (ev: StateEventMap[K]) => void,\n\t\toptions?: boolean | AddEventListenerOptions,\n\t) {\n\t\t//@ts-expect-error\n\t\tsuper.addEventListener(type, listener, options);\n\t}\n\theight = 18;\n\tcharWidth = 18;\n\trenderToCanvas(ctx: CanvasRenderingContext2D) {\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tconst fontSize = this.fontSize;\n\t\tconst height = Math.floor(ctx.canvas.height / this.fontSize);\n\t\tthis.height = height;\n\t\tctx.font = `${fontSize}px monospace`;\n\t\tconst charWidth = ctx.measureText(\"a\").width;\n\t\tthis.charWidth = charWidth;\n\t\tctx.textBaseline = \"hanging\";\n\t\tconst linedown = Math.floor(this.scroll.linedown);\n\t\tconst widthNeeded = this.widthNeeded();\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (line && line.errored) {\n\t\t\t\tctx.fillStyle = \"lemonchiffon\";\n\t\t\t\tconst y = (i - linedown) * fontSize;\n\t\t\t\tctx.fillRect(widthNeeded + 10, y, ctx.canvas.width, this.fontSize);\n\t\t\t}\n\t\t}\n\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tctx.fillStyle = \"LightBlue\";\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const high of this.cursor.highlights) {\n\t\t\t\tconst h = getStart(high.start, high.end);\n\t\t\t\tif (h[0].line >= height + linedown || h[1].line < linedown) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = h[0].line; i <= h[1].line && i < height + linedown; i++) {\n\t\t\t\t\tlet startx: number;\n\t\t\t\t\tlet endx: number;\n\t\t\t\t\tif (h[0].line === i) {\n\t\t\t\t\t\tstartx = widthNeeded + 10 + h[0].index * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartx = widthNeeded + 10;\n\t\t\t\t\t}\n\t\t\t\t\tconst endline = this.lines[i];\n\t\t\t\t\tif (h[1].line === i) {\n\t\t\t\t\t\tendx = widthNeeded + 10 + endline.moveCursor(h[1].index, 0) * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendx = widthNeeded + 10 + endline.length() * charWidth;\n\t\t\t\t\t}\n\t\t\t\t\tendx -= startx;\n\t\t\t\t\tconst y = (i - linedown) * fontSize;\n\t\t\t\t\tctx.fillRect(startx, y, endx, fontSize);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (!line) break;\n\t\t\tconst y = (i - linedown) * fontSize;\n\n\t\t\tlet cursors: number[] = [];\n\t\t\tif ((this.blinkOffset + Date.now()) % this.blinkInterval < this.blinkInterval / 2) {\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tcursors = this.cursor.possitions.filter((_) => _.line === i).map((_) => _.index);\n\t\t\t\t} else {\n\t\t\t\t\tcursors = this.cursor.highlights.filter((_) => _.end.line === i).map((_) => _.end.index);\n\t\t\t\t}\n\t\t\t}\n\t\t\tline.drawLine(ctx, widthNeeded + 10, y, charWidth, cursors);\n\t\t\tctx.fillStyle = \"grey\";\n\t\t\tctx.fillRect(widthNeeded + 5, y, 1, fontSize);\n\t\t\tctx.fillStyle = \"black\";\n\t\t\tctx.fillText(`${i + 1}`, 4, y);\n\t\t}\n\t}\n\twidthNeeded() {\n\t\treturn this.charWidth * Math.floor(Math.log(Math.max(this.lines.length, 33)));\n\t}\n\tblinkInterval = 800;\n\tblinkOffset = 0;\n\tfocusCursors() {\n\t\tthis.blinkOffset = -Date.now() % this.blinkInterval;\n\t}\n\tcollectCurors() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tthis.cursor.possitions.sort((a, b) => {\n\t\t\t\tif (a.line < b.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (a.line > b.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn +(a.index < b.index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.cursor.possitions = this.cursor.possitions.filter((a, i, array) => {\n\t\t\t\tif (i === 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn a.index !== array[i - 1].index || a.line !== array[i - 1].line;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tgetState() {\n\t\treturn {lines: this.lines, cursor: structuredClone(this.cursor)};\n\t}\n\tpushPast() {\n\t\tthis.past.push(this.getState());\n\t\tthis.future = [];\n\t}\n\tstring() {\n\t\treturn this.lines.map((_) => _.str).join(\"\\n\");\n\t}\n\tcastToHighlights() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tconst arr: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[] = [];\n\t\t\tfor (const pos of this.cursor.possitions) {\n\t\t\t\tarr.push({\n\t\t\t\t\tstart: pos,\n\t\t\t\t\tend: structuredClone(pos),\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.cursor = {highlights: arr};\n\t\t}\n\t}\n\tsortHighlights() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor.highlights.sort((a, b) => {\n\t\t\t\tconst [sa] = getStart(a.end, a.start);\n\t\t\t\tconst [sb] = getStart(b.end, b.start);\n\t\t\t\tif (sa.line < sb.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (sa.line > sb.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (sa.index < sb.index) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet prev = getStart(this.cursor.highlights[0].end, this.cursor.highlights[0].start);\n\n\t\t\tlet first = true;\n\t\t\tconst cursor: cursor = {highlights: []};\n\t\t\tcursor.highlights.push(this.cursor.highlights[0]);\n\t\t\tfor (const pos of this.cursor.highlights) {\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst cur = getStart(pos.end, pos.start);\n\t\t\t\tif (\n\t\t\t\t\tcur[0].line < prev[1].line ||\n\t\t\t\t\t(cur[0].line == prev[1].line && cur[0].index < prev[1].index)\n\t\t\t\t) {\n\t\t\t\t\tprev[1].line = cur[1].line;\n\t\t\t\t\tprev[1].index = cur[1].index;\n\t\t\t\t} else {\n\t\t\t\t\tcursor.highlights.push(pos);\n\t\t\t\t\tprev = cur;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor = cursor;\n\t\t}\n\t}\n\tcastToCursorsPassive() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.cursor = {\n\t\t\t\tpossitions: this.cursor.highlights.map((_) => _.end),\n\t\t\t};\n\t\t}\n\t}\n\tgiveError(e: AssemblError) {\n\t\tthis.lines[e.line].error();\n\t}\n\tcastToCursorsDestructive() {\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.sortHighlights();\n\t\t\tconst arr: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[] = [];\n\t\t\tlet i = 0;\n\t\t\tlet h:\n\t\t\t\t| {\n\t\t\t\t\t\tline: number;\n\t\t\t\t\t\tindex: number;\n\t\t\t\t  }[]\n\t\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\tlet realLineIndex = 0;\n\t\t\tconst lines: Line[] = [];\n\t\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\t\tconst line = this.lines[j];\n\t\t\t\tif (h && j >= h[0].line) {\n\t\t\t\t\tlet destroyed = false;\n\t\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\t\tdestroyed = true;\n\t\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t\tconst dline = line.deleteRanges(highlights);\n\t\t\t\t\tlet newLine: Line = dline.line;\n\t\t\t\t\tlet offset = 0;\n\t\t\t\t\tif (destroyed) {\n\t\t\t\t\t\tconst pop = lines.pop();\n\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\toffset = pop.str.length;\n\t\t\t\t\t\t\tnewLine = new Line(pop.str + dline.line.str, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trealLineIndex++;\n\t\t\t\t\t}\n\t\t\t\t\tlines.push(newLine);\n\t\t\t\t\tfor (const thing of dline.fakeCurors) {\n\t\t\t\t\t\tconst i = thing + offset;\n\t\t\t\t\t\tarr.push({\n\t\t\t\t\t\t\tline: realLineIndex - 1,\n\t\t\t\t\t\t\tindex: newLine.getFakeIndex(i),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (h) {\n\t\t\t\t\t\tif (h[1].line === j) {\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tj = h[1].line - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\trealLineIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\tthis.lines = lines;\n\t\t\tthis.cursor = {possitions: arr};\n\t\t\tthis.collectCurors();\n\t\t}\n\t}\n\tsave() {\n\t\tthis.dispatchEvent(new Event(\"save\"));\n\t}\n\tshiftArrow(e: KeyboardEvent) {\n\t\tthis.castToHighlights();\n\t\tif (!(\"highlights\" in this.cursor)) throw Error(\"this will never happen :3\");\n\t\tswitch (e.key) {\n\t\t\tcase \"ArrowRight\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowLeft\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowDown\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\tif (this.lines.length === cursor.end.line) {\n\t\t\t\t\t\tcursor.end.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowUp\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\tif (cursor.end.line === -1) {\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.sortHighlights();\n\t}\n\tcopy() {\n\t\tif (!(\"highlights\" in this.cursor)) {\n\t\t\tconsole.warn(\"copying for regular cursors is not implemented\");\n\t\t\treturn [];\n\t\t}\n\t\tthis.sortHighlights();\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\n\t\tlet i = 0;\n\t\tlet h:\n\t\t\t| {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t  }[]\n\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\tconst strings: string[] = [];\n\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\tconst line = this.lines[j];\n\t\t\tif (h && j >= h[0].line) {\n\t\t\t\tif (h[0].line < j && h[1].line > j) {\n\t\t\t\t\tstrings.push(this.lines[j].str);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t}\n\t\t\t\tconst dline = line.getRanges(highlights);\n\t\t\t\tstrings.push(...dline);\n\t\t\t}\n\t\t}\n\t\treturn strings;\n\t}\n\townCanvas(c: HTMLCanvasElement) {\n\t\tlet lastClicked = 0;\n\t\tconst ctx = c.getContext(\"2d\");\n\t\tif (!ctx) throw Error(\"Unable to get canvas context 2d\");\n\t\tconst mut = new ResizeObserver((e) => {\n\t\t\tfor (const _ of e) {\n\t\t\t}\n\t\t\tconst box = c.parentElement!.getBoundingClientRect();\n\t\t\tc.width = box.width;\n\t\t\tc.height = box.height;\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.scroll.linedown += (e.deltaY / 400) * this.height;\n\t\t\t\tthis.scroll.linedown = Math.min(\n\t\t\t\t\tthis.scroll.linedown,\n\t\t\t\t\tthis.lines.length - c.height / this.fontSize + 1,\n\t\t\t\t);\n\t\t\t\tthis.scroll.linedown = Math.max(this.scroll.linedown, 0);\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t},\n\t\t\t{passive: false},\n\t\t);\n\n\t\tc.contentEditable = \"true\";\n\n\t\tc.addEventListener(\"paste\", (event) => {\n\t\t\tthis.castToCursorsDestructive();\n\t\t\tthis.collectCurors();\n\t\t\tconsole.log(\"paste\");\n\t\t\tevent.preventDefault();\n\t\t\tif (!event.clipboardData) return;\n\t\t\tconst paste = event.clipboardData.getData(\"text\");\n\t\t\tconsole.log(paste);\n\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\tlet newI = 0;\n\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\tconst replace = this.lines[i].paste(\n\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\tpaste,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\tnewI++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = newLines;\n\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"keydown\", (e) => {\n\t\t\tthis.collectCurors();\n\t\t\tif (e.key.toLowerCase() === \"v\" && e.ctrlKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"z\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.past.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.future.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"y\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.future.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.past.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\tif (e.key.startsWith(\"Arrow\")) {\n\t\t\t\tif (!e.shiftKey) {\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t\tif (!(\"possitions\" in this.cursor))\n\t\t\t\t\t\tthrow new Error(\"was just cast, should be possitions\");\n\t\t\t\t\tswitch (e.key) {\n\t\t\t\t\t\tcase \"ArrowLeft\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[cursor.line].length();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowRight\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowDown\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\tif (this.lines.length === cursor.line) {\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowUp\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\tif (cursor.line === -1) {\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.shiftArrow(e);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.length === 1 || e.key === \"Backspace\" || e.key === \"Enter\" || e.key === \"Tab\") &&\n\t\t\t\t!e.metaKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.ctrlKey\n\t\t\t) {\n\t\t\t\tif (\"highlights\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t\tif (e.key === \"Backspace\") {\n\t\t\t\t\t\tthis.focusCursors();\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet key = e.key;\n\t\t\t\tif (key === \"Tab\") {\n\t\t\t\t\tkey = \"\t\";\n\t\t\t\t}\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\t\tlet newI = 0;\n\t\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\t\tconst replace = this.lines[i].insert(\n\t\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (replace.orphaned) {\n\t\t\t\t\t\t\t\tlet pop = newLines.pop();\n\t\t\t\t\t\t\t\tlet line: Line;\n\t\t\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\t\t\tline = new Line(pop.str + replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tline = new Line(replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tpop = line;\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (const thing of replace.orphaned.cursors) {\n\t\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\t\tline: newI - 1,\n\t\t\t\t\t\t\t\t\t\tindex: line.getFakeIndex(Math.max(thing, 0) + pop.str.length),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\t\tthis.lines = newLines;\n\t\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.toLowerCase() === \"c\" || e.key.toLowerCase() === \"x\") &&\n\t\t\t\te.ctrlKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.metaKey\n\t\t\t) {\n\t\t\t\tnavigator.clipboard.writeText(this.copy().join(\"\\n\"));\n\t\t\t\tif (e.key === \"x\") {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t}\n\t\t\t} else if (e.key.toLowerCase() === \"a\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tconsole.log(\"not here?\");\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t} else {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: {index: 0, line: 0},\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tindex: this.lines[this.lines.length - 1].length(),\n\t\t\t\t\t\t\t\t\tline: this.lines.length - 1,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (e.key === \"a\" && !e.ctrlKey && e.altKey && !e.metaKey) {\n\t\t\t\tthis.assemble();\n\t\t\t} else if (e.key === \"Backspace\" && e.ctrlKey) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tif (\"highlight\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tthis.castToHighlights();\n\t\t\t\tif (\"possitions\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, -2);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t} else if (e.key === \"s\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tlet dragged: undefined | {line: number; index: number} = undefined;\n\t\tc.addEventListener(\"mousedown\", (e) => {\n\t\t\te.preventDefault();\n\t\t\tthis.focusCursors();\n\t\t\tc.focus();\n\t\t\tif (e.button === 0) {\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tdragged = {line: linePos, index: curse};\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tlet start;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tstart = this.cursor.possitions[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart = this.cursor.highlights[0].start;\n\t\t\t\t\t}\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//TODO make this a setting\n\t\t\t\tif (Date.now() < lastClicked + 300) {\n\t\t\t\t\tdragged = undefined;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tlastClicked = Date.now();\n\t\t\t\t\t\tconst bounds = line.getWordBounds(curse);\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: bounds[0]},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: bounds[1]},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: 0},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: line.length()},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlastClicked = Date.now();\n\t\t\t\tconst cursor = {line: linePos, index: curse};\n\t\t\t\tif (!e.altKey) {\n\t\t\t\t\tthis.cursor = {possitions: [cursor]};\n\t\t\t\t} else {\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tthis.cursor.possitions.push(cursor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor.highlights.push({\n\t\t\t\t\t\t\tstart: cursor,\n\t\t\t\t\t\t\tend: structuredClone(cursor),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.collectCurors();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"mouseup\", () => {\n\t\t\tdragged = undefined;\n\t\t});\n\t\tc.addEventListener(\"mousemove\", (e) => {\n\t\t\tif (dragged) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tif (linePos !== dragged.line && dragged.index !== curse) {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: dragged,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsetInterval(() => {\n\t\t\tthis.renderToCanvas(ctx);\n\t\t}, this.blinkInterval / 2);\n\t\tmut.observe(c);\n\t\tthis.renderToCanvas(ctx);\n\t}\n\tassemble() {\n\t\t//TODO I'm sure there's more I can do to make this much smaller in RAM\n\t\ttry {\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.startingAssembly() + \"\\n\\n\");\n\t\t\tconst ram = assemble(this.string());\n\t\t\tconst emu = new Symstem(ram, this.console);\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.finishedAssembly() + \"\\n\\n\");\n\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", emu));\n\t\t} catch (e) {\n\t\t\tif (e instanceof AssemblError) {\n\t\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", e));\n\t\t\t} else {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\tcreateEditor(): HTMLDivElement {\n\t\tconst area = document.createElement(\"div\");\n\t\tarea.classList.add(\"flexttb\", \"editor\");\n\t\tconst c = document.createElement(\"canvas\");\n\t\tarea.append(c);\n\t\tthis.ownCanvas(c);\n\t\treturn area;\n\t}\n}\nclass AssembleEvent extends Event {\n\tsys: Symstem | AssemblError;\n\tconstructor(code: string, sys: Symstem | AssemblError) {\n\t\tsuper(code);\n\t\tthis.sys = sys;\n\t}\n}\nexport {Editor, AssembleEvent};\n"],"names":["assemble","AssemblError","Symstem","I18n","Line","redispatched","WeakSet","window","addEventListener","event","has","e","ClipboardEvent","add","document","activeElement","dispatchEvent","Editor","EventTarget","lines","tabLength","cursor","possitions","line","index","scroll","linedown","charleft","console","fileName","fontSize","past","future","constructor","asm","split","map","_","length","push","type","listener","options","height","charWidth","renderToCanvas","ctx","clearRect","canvas","width","Math","floor","font","measureText","textBaseline","widthNeeded","i","errored","fillStyle","y","fillRect","getStart","o1","o2","high","highlights","h","start","end","startx","endx","endline","moveCursor","cursors","blinkOffset","Date","now","blinkInterval","filter","drawLine","fillText","log","max","focusCursors","collectCurors","sort","a","b","array","getState","structuredClone","pushPast","string","str","join","castToHighlights","arr","pos","sortHighlights","sa","sb","prev","first","cur","castToCursorsPassive","giveError","error","castToCursorsDestructive","realLineIndex","j","destroyed","undefined","dline","deleteRanges","newLine","offset","pop","thing","fakeCurors","getFakeIndex","Event","save","shiftArrow","Error","key","out","ctrlKey","Infinity","min","copy","warn","strings","getRanges","ownCanvas","c","lastClicked","getContext","mut","ResizeObserver","box","parentElement","getBoundingClientRect","preventDefault","deltaY","passive","contentEditable","clipboardData","paste","getData","Set","newLines","newI","replace","toLowerCase","altKey","metaKey","startsWith","shiftKey","insert","orphaned","text","navigator","clipboard","writeText","dragged","focus","button","linePos","offsetY","curse","round","offsetX","bounds","getWordBounds","setInterval","observe","addMessage","startingAssembly","ram","emu","finishedAssembly","AssembleEvent","createEditor","area","createElement","classList","append","sys","code"],"mappings":"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"}