{"version":3,"sources":["../../../src/webpage/editor/editor.ts"],"sourcesContent":["import {assemble, AssemblError} from \"../assembler/assembler.js\";\nimport {Console} from \"../emulator/console.js\";\nimport {Symstem} from \"../emulator/emulator.js\";\nimport {I18n} from \"../i18n.js\";\nimport {Directory} from \"../utils/utils.js\";\nimport {Line} from \"./line.js\";\ninterface StateEventMap {\n\tAssemble: AssembleEvent;\n\tchanged: Event;\n\tsave: Event;\n}\ntype cursor =\n\t| {\n\t\t\tpossitions: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[];\n\t  }\n\t| {\n\t\t\thighlights: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[];\n\t  };\nconst redispatched = new WeakSet();\nwindow.addEventListener(\"paste\", (event) => {\n\tif (redispatched.has(event)) {\n\t\treturn;\n\t}\n\tconst e = new ClipboardEvent(\"paste\", event);\n\tredispatched.add(e);\n\tif (document.activeElement) {\n\t\tdocument.activeElement.dispatchEvent(e);\n\t}\n});\nclass Editor extends EventTarget {\n\tlines: Line[];\n\ttabLength = 8;\n\tcursor: cursor = {\n\t\tpossitions: [\n\t\t\t{\n\t\t\t\tline: 1,\n\t\t\t\tindex: 0,\n\t\t\t},\n\t\t],\n\t};\n\tscroll = {\n\t\tlinedown: 0,\n\t\tcharleft: 0,\n\t};\n\tconsole: Console;\n\tfileName: string;\n\tfileDir?: string;\n\tfontSize = 14;\n\tpast: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tfuture: {lines: Line[]; cursor: Editor[\"cursor\"]}[] = [];\n\tdir: Directory | undefined;\n\tconstructor(asm: string, fileName = \"name\", console: Console, proj: Directory | undefined) {\n\t\tsuper();\n\t\tthis.console = console;\n\t\tthis.lines = asm.split(\"\\n\").map((_) => new Line(_, this));\n\t\tif (this.lines.length === 0) {\n\t\t\tthis.lines.push(new Line(\"\", this));\n\t\t}\n\t\tthis.fileName = fileName;\n\t\tthis.dir = proj;\n\t}\n\taddEventListener<K extends keyof StateEventMap>(\n\t\ttype: K,\n\t\tlistener: (ev: StateEventMap[K]) => void,\n\t\toptions?: boolean | AddEventListenerOptions,\n\t) {\n\t\t//@ts-expect-error\n\t\tsuper.addEventListener(type, listener, options);\n\t}\n\theight = 18;\n\tcharWidth = 18;\n\trenderToCanvas(ctx: CanvasRenderingContext2D) {\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tconst fontSize = this.fontSize;\n\t\tconst height = Math.floor(ctx.canvas.height / this.fontSize);\n\t\tthis.height = height;\n\t\tctx.font = `${fontSize}px monospace`;\n\t\tconst charWidth = ctx.measureText(\"a\").width;\n\t\tthis.charWidth = charWidth;\n\t\tctx.textBaseline = \"hanging\";\n\t\tconst linedown = Math.floor(this.scroll.linedown);\n\t\tconst widthNeeded = this.widthNeeded();\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (line && line.errored) {\n\t\t\t\tctx.fillStyle = \"lemonchiffon\";\n\t\t\t\tconst y = (i - linedown) * fontSize;\n\t\t\t\tctx.fillRect(widthNeeded + 10, y, ctx.canvas.width, this.fontSize);\n\t\t\t}\n\t\t}\n\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tctx.fillStyle = \"LightBlue\";\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const high of this.cursor.highlights) {\n\t\t\t\tconst h = getStart(high.start, high.end);\n\t\t\t\tif (h[0].line >= height + linedown || h[1].line < linedown) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = h[0].line; i <= h[1].line && i < height + linedown; i++) {\n\t\t\t\t\tlet startx: number;\n\t\t\t\t\tlet endx: number;\n\t\t\t\t\tif (h[0].line === i) {\n\t\t\t\t\t\tstartx = widthNeeded + 10 + h[0].index * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartx = widthNeeded + 10;\n\t\t\t\t\t}\n\t\t\t\t\tconst endline = this.lines[i];\n\t\t\t\t\tconst maxWidth = widthNeeded + 10 + endline.length() * charWidth;\n\t\t\t\t\tif (h[1].line === i) {\n\t\t\t\t\t\tendx = widthNeeded + 10 + endline.moveCursor(h[1].index, 0) * charWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendx = maxWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (endx === maxWidth) {\n\t\t\t\t\t\tendx += 3;\n\t\t\t\t\t}\n\t\t\t\t\tendx -= startx;\n\t\t\t\t\tconst y = (i - linedown) * fontSize;\n\n\t\t\t\t\tctx.fillRect(startx, y, endx, fontSize);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = linedown; i < height + linedown; i++) {\n\t\t\tconst line = this.lines[i];\n\t\t\tif (!line) break;\n\t\t\tconst y = (i - linedown) * fontSize;\n\n\t\t\tlet cursors: number[] = [];\n\t\t\tif ((this.blinkOffset + Date.now()) % this.blinkInterval < this.blinkInterval / 2) {\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tcursors = this.cursor.possitions.filter((_) => _.line === i).map((_) => _.index);\n\t\t\t\t} else {\n\t\t\t\t\tcursors = this.cursor.highlights.filter((_) => _.end.line === i).map((_) => _.end.index);\n\t\t\t\t}\n\t\t\t}\n\t\t\tline.drawLine(ctx, widthNeeded + 10, y, charWidth, cursors);\n\t\t\tctx.fillStyle = \"grey\";\n\t\t\tctx.fillRect(widthNeeded + 5, y, 1, fontSize);\n\t\t\tctx.fillStyle = \"black\";\n\t\t\tctx.fillText(`${i + 1}`, 4, y);\n\t\t}\n\t}\n\twidthNeeded() {\n\t\treturn this.charWidth * Math.floor(Math.log(Math.max(this.lines.length, 33)));\n\t}\n\tblinkInterval = 800;\n\tblinkOffset = 0;\n\tfocusCursors() {\n\t\tthis.blinkOffset = -Date.now() % this.blinkInterval;\n\t}\n\tcollectCurors() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tthis.cursor.possitions.sort((a, b) => {\n\t\t\t\tif (a.line < b.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (a.line > b.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn +(a.index < b.index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.cursor.possitions = this.cursor.possitions.filter((a, i, array) => {\n\t\t\t\tif (i === 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn a.index !== array[i - 1].index || a.line !== array[i - 1].line;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tgetState() {\n\t\treturn {lines: this.lines, cursor: structuredClone(this.cursor)};\n\t}\n\tpushPast() {\n\t\tthis.past.push(this.getState());\n\t\tthis.future = [];\n\t}\n\tstring() {\n\t\treturn this.lines.map((_) => _.str).join(\"\\n\");\n\t}\n\tcastToHighlights() {\n\t\tif (\"possitions\" in this.cursor) {\n\t\t\tconst arr: {\n\t\t\t\tstart: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t\tend: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t};\n\t\t\t}[] = [];\n\t\t\tfor (const pos of this.cursor.possitions) {\n\t\t\t\tarr.push({\n\t\t\t\t\tstart: pos,\n\t\t\t\t\tend: structuredClone(pos),\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.cursor = {highlights: arr};\n\t\t}\n\t}\n\tsortHighlights() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tfunction getStart(\n\t\t\t\to1: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t\to2: {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t\t},\n\t\t\t) {\n\t\t\t\tif (o1.line < o2.line) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\t\treturn [o1, o2];\n\t\t\t\t} else {\n\t\t\t\t\treturn [o2, o1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor.highlights.sort((a, b) => {\n\t\t\t\tconst [sa] = getStart(a.end, a.start);\n\t\t\t\tconst [sb] = getStart(b.end, b.start);\n\t\t\t\tif (sa.line < sb.line) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (sa.line > sb.line) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (sa.index < sb.index) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet prev = getStart(this.cursor.highlights[0].end, this.cursor.highlights[0].start);\n\n\t\t\tlet first = true;\n\t\t\tconst cursor: cursor = {highlights: []};\n\t\t\tcursor.highlights.push(this.cursor.highlights[0]);\n\t\t\tfor (const pos of this.cursor.highlights) {\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst cur = getStart(pos.end, pos.start);\n\t\t\t\tif (\n\t\t\t\t\tcur[0].line < prev[1].line ||\n\t\t\t\t\t(cur[0].line == prev[1].line && cur[0].index < prev[1].index)\n\t\t\t\t) {\n\t\t\t\t\tprev[1].line = cur[1].line;\n\t\t\t\t\tprev[1].index = cur[1].index;\n\t\t\t\t} else {\n\t\t\t\t\tcursor.highlights.push(pos);\n\t\t\t\t\tprev = cur;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cursor = cursor;\n\t\t}\n\t}\n\tcastToCursorsPassive() {\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.cursor = {\n\t\t\t\tpossitions: this.cursor.highlights.map((_) => _.end),\n\t\t\t};\n\t\t}\n\t}\n\tgiveError(e: AssemblError) {\n\t\tthis.lines[e.line].error();\n\t}\n\tcastToCursorsDestructive() {\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\t\tif (\"highlights\" in this.cursor) {\n\t\t\tthis.sortHighlights();\n\t\t\tconst arr: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t}[] = [];\n\t\t\tlet i = 0;\n\t\t\tlet h:\n\t\t\t\t| {\n\t\t\t\t\t\tline: number;\n\t\t\t\t\t\tindex: number;\n\t\t\t\t  }[]\n\t\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\tlet realLineIndex = 0;\n\t\t\tconst lines: Line[] = [];\n\t\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\t\tconst line = this.lines[j];\n\t\t\t\tif (h && j >= h[0].line) {\n\t\t\t\t\tlet destroyed = false;\n\t\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\t\tdestroyed = true;\n\t\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t\tconst dline = line.deleteRanges(highlights);\n\t\t\t\t\tlet newLine: Line = dline.line;\n\t\t\t\t\tlet offset = 0;\n\t\t\t\t\tif (destroyed) {\n\t\t\t\t\t\tconst pop = lines.pop();\n\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\toffset = pop.str.length;\n\t\t\t\t\t\t\tnewLine = new Line(pop.str + dline.line.str, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trealLineIndex++;\n\t\t\t\t\t}\n\t\t\t\t\tlines.push(newLine);\n\t\t\t\t\tfor (const thing of dline.fakeCurors) {\n\t\t\t\t\t\tconst i = thing + offset;\n\t\t\t\t\t\tarr.push({\n\t\t\t\t\t\t\tline: realLineIndex - 1,\n\t\t\t\t\t\t\tindex: newLine.getFakeIndex(i),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (h) {\n\t\t\t\t\t\tif (h[1].line === j) {\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tj = h[1].line - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\trealLineIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\tthis.lines = lines;\n\t\t\tthis.cursor = {possitions: arr};\n\t\t\tthis.collectCurors();\n\t\t}\n\t}\n\tsave() {\n\t\tthis.dispatchEvent(new Event(\"save\"));\n\t}\n\tshiftArrow(e: KeyboardEvent) {\n\t\tthis.castToHighlights();\n\t\tif (!(\"highlights\" in this.cursor)) throw Error(\"this will never happen :3\");\n\t\tswitch (e.key) {\n\t\t\tcase \"ArrowRight\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowLeft\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowDown\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line++;\n\t\t\t\t\tif (this.lines.length === cursor.end.line) {\n\t\t\t\t\t\tcursor.end.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.min(this.lines.length - 1, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowUp\":\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\tif (cursor.end.line === -1) {\n\t\t\t\t\t\tcursor.end.index = 0;\n\t\t\t\t\t}\n\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.sortHighlights();\n\t}\n\tcopy() {\n\t\tif (!(\"highlights\" in this.cursor)) {\n\t\t\tconsole.warn(\"copying for regular cursors is not implemented\");\n\t\t\treturn [];\n\t\t}\n\t\tthis.sortHighlights();\n\t\tfunction getStart(\n\t\t\to1: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t\to2: {\n\t\t\t\tline: number;\n\t\t\t\tindex: number;\n\t\t\t},\n\t\t) {\n\t\t\tif (o1.line < o2.line) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else if (o1.line > o2.line) {\n\t\t\t\treturn [o2, o1];\n\t\t\t} else if (o1.index < o2.index) {\n\t\t\t\treturn [o1, o2];\n\t\t\t} else {\n\t\t\t\treturn [o2, o1];\n\t\t\t}\n\t\t}\n\n\t\tlet i = 0;\n\t\tlet h:\n\t\t\t| {\n\t\t\t\t\tline: number;\n\t\t\t\t\tindex: number;\n\t\t\t  }[]\n\t\t\t| undefined = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\tconst strings: string[] = [];\n\t\tfor (let j = 0; j < this.lines.length; j++) {\n\t\t\tconst line = this.lines[j];\n\t\t\tif (h && j >= h[0].line) {\n\t\t\t\tif (h[0].line < j && h[1].line > j) {\n\t\t\t\t\tstrings.push(this.lines[j].str);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst highlights: [number, number][] = [];\n\t\t\t\tif (j !== h[0].line) {\n\t\t\t\t\thighlights.push([0, h[1].index]);\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (h && j === h[0].line) {\n\t\t\t\t\tif (h[1].line !== j) {\n\t\t\t\t\t\thighlights.push([h[0].index, line.length()]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thighlights.push([h[0].index, h[1].index]);\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t\tif (!this.cursor.highlights[i]) {\n\t\t\t\t\t\th = undefined;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\th = getStart(this.cursor.highlights[i].end, this.cursor.highlights[i].start);\n\t\t\t\t}\n\t\t\t\tconst dline = line.getRanges(highlights);\n\t\t\t\tstrings.push(...dline);\n\t\t\t}\n\t\t}\n\t\treturn strings;\n\t}\n\townCanvas(c: HTMLCanvasElement) {\n\t\tlet lastClicked = 0;\n\t\tconst ctx = c.getContext(\"2d\");\n\t\tif (!ctx) throw Error(\"Unable to get canvas context 2d\");\n\t\tconst mut = new ResizeObserver((e) => {\n\t\t\tfor (const _ of e) {\n\t\t\t}\n\t\t\tconst box = c.parentElement!.getBoundingClientRect();\n\t\t\tc.width = box.width;\n\t\t\tc.height = box.height;\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.scroll.linedown += (e.deltaY / 400) * this.height;\n\t\t\t\tthis.scroll.linedown = Math.min(\n\t\t\t\t\tthis.scroll.linedown,\n\t\t\t\t\tthis.lines.length - c.height / this.fontSize + 1,\n\t\t\t\t);\n\t\t\t\tthis.scroll.linedown = Math.max(this.scroll.linedown, 0);\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t},\n\t\t\t{passive: false},\n\t\t);\n\n\t\tc.contentEditable = \"true\";\n\n\t\tc.addEventListener(\"paste\", (event) => {\n\t\t\tthis.castToCursorsDestructive();\n\t\t\tthis.collectCurors();\n\t\t\tconsole.log(\"paste\");\n\t\t\tevent.preventDefault();\n\t\t\tif (!event.clipboardData) return;\n\t\t\tconst paste = event.clipboardData.getData(\"text\");\n\t\t\tconsole.log(paste);\n\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\tlet newI = 0;\n\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\tconst replace = this.lines[i].paste(\n\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\tpaste,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\tnewI++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = newLines;\n\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"keydown\", (e) => {\n\t\t\tthis.collectCurors();\n\t\t\tif (e.key.toLowerCase() === \"v\" && e.ctrlKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"z\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.past.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.future.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.key == \"y\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tconst pop = this.future.pop();\n\t\t\t\tif (!pop) return;\n\t\t\t\tthis.past.push(this.getState());\n\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\tthis.lines = pop.lines;\n\t\t\t\tthis.cursor = pop.cursor;\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\tif (e.key.startsWith(\"Arrow\")) {\n\t\t\t\tif (!e.shiftKey) {\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t\tif (!(\"possitions\" in this.cursor))\n\t\t\t\t\t\tthrow new Error(\"was just cast, should be possitions\");\n\t\t\t\t\tswitch (e.key) {\n\t\t\t\t\t\tcase \"ArrowLeft\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? -2 : -1);\n\t\t\t\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[cursor.line].length();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowRight\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tconst out = this.lines[cursor.line].moveCursor(cursor.index, e.ctrlKey ? 2 : 1);\n\t\t\t\t\t\t\t\tif (out === Infinity) {\n\t\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcursor.index = out;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowDown\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line++;\n\t\t\t\t\t\t\t\tif (this.lines.length === cursor.line) {\n\t\t\t\t\t\t\t\t\tcursor.index = this.lines[this.lines.length - 1].length();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.min(this.lines.length - 1, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"ArrowUp\":\n\t\t\t\t\t\t\tfor (const cursor of this.cursor.possitions) {\n\t\t\t\t\t\t\t\tcursor.line--;\n\t\t\t\t\t\t\t\tif (cursor.line === -1) {\n\t\t\t\t\t\t\t\t\tcursor.index = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcursor.line = Math.max(0, cursor.line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.shiftArrow(e);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.length === 1 || e.key === \"Backspace\" || e.key === \"Enter\" || e.key === \"Tab\") &&\n\t\t\t\t!e.metaKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.ctrlKey\n\t\t\t) {\n\t\t\t\tif (\"highlights\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t\tif (e.key === \"Backspace\") {\n\t\t\t\t\t\tthis.focusCursors();\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet key = e.key;\n\t\t\t\tif (key === \"Tab\") {\n\t\t\t\t\tkey = \"\t\";\n\t\t\t\t}\n\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tconst lines = new Set(this.cursor.possitions.map((_) => _.line));\n\t\t\t\t\tconst newLines: Line[] = [];\n\t\t\t\t\tconst possitions: {index: number; line: number}[] = [];\n\t\t\t\t\tlet newI = 0;\n\t\t\t\t\tfor (const i in this.lines) {\n\t\t\t\t\t\tif (lines.has(+i)) {\n\t\t\t\t\t\t\tconst replace = this.lines[i].insert(\n\t\t\t\t\t\t\t\tthis.cursor.possitions.filter((_) => _.line === +i).map((_) => _.index),\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (replace.orphaned) {\n\t\t\t\t\t\t\t\tlet pop = newLines.pop();\n\t\t\t\t\t\t\t\tlet line: Line;\n\t\t\t\t\t\t\t\tif (pop) {\n\t\t\t\t\t\t\t\t\tline = new Line(pop.str + replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tline = new Line(replace.orphaned.text, this);\n\t\t\t\t\t\t\t\t\tpop = line;\n\t\t\t\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (const thing of replace.orphaned.cursors) {\n\t\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\t\tline: newI - 1,\n\t\t\t\t\t\t\t\t\t\tindex: line.getFakeIndex(Math.max(thing, 0) + pop.str.length),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.cursors) {\n\t\t\t\t\t\t\t\tpossitions.push({\n\t\t\t\t\t\t\t\t\tline: newI + thing.line,\n\t\t\t\t\t\t\t\t\tindex: thing.index,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const thing of replace.lines) {\n\t\t\t\t\t\t\t\tnewLines.push(thing);\n\t\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewLines.push(this.lines[i]);\n\t\t\t\t\t\t\tnewI++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(new Event(\"changed\"));\n\t\t\t\t\tthis.lines = newLines;\n\t\t\t\t\tthis.cursor.possitions = possitions;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(e.key.toLowerCase() === \"c\" || e.key.toLowerCase() === \"x\") &&\n\t\t\t\te.ctrlKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!e.metaKey\n\t\t\t) {\n\t\t\t\tnavigator.clipboard.writeText(this.copy().join(\"\\n\"));\n\t\t\t\tif (e.key === \"x\") {\n\t\t\t\t\tthis.pushPast();\n\t\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\t}\n\t\t\t} else if (e.key.toLowerCase() === \"a\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tconsole.log(\"not here?\");\n\t\t\t\t\tthis.castToCursorsPassive();\n\t\t\t\t} else {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: {index: 0, line: 0},\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tindex: this.lines[this.lines.length - 1].length(),\n\t\t\t\t\t\t\t\t\tline: this.lines.length - 1,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (e.key === \"a\" && !e.ctrlKey && e.altKey && !e.metaKey) {\n\t\t\t\tthis.assemble();\n\t\t\t} else if (e.key === \"Backspace\" && e.ctrlKey) {\n\t\t\t\tthis.pushPast();\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tif (\"highlight\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tthis.castToHighlights();\n\t\t\t\tif (\"possitions\" in this.cursor) throw Error(\"oops, idk how I got here!\");\n\t\t\t\tfor (const cursor of this.cursor.highlights) {\n\t\t\t\t\tconst out = this.lines[cursor.end.line].moveCursor(cursor.end.index, -2);\n\t\t\t\t\tif (out === -Infinity) {\n\t\t\t\t\t\tcursor.end.line--;\n\t\t\t\t\t\tcursor.end.line = Math.max(0, cursor.end.line);\n\t\t\t\t\t\tcursor.end.index = this.lines[cursor.end.line].length();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcursor.end.index = out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.castToCursorsDestructive();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\treturn;\n\t\t\t} else if (e.key === \"s\" && e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t\tthis.focusCursors();\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tlet dragged: undefined | {line: number; index: number} = undefined;\n\t\tc.addEventListener(\"mousedown\", (e) => {\n\t\t\te.preventDefault();\n\t\t\tthis.focusCursors();\n\t\t\tc.focus();\n\t\t\tif (e.button === 0) {\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tdragged = {line: linePos, index: curse};\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tlet start;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tstart = this.cursor.possitions[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart = this.cursor.highlights[0].start;\n\t\t\t\t\t}\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//TODO make this a setting\n\t\t\t\tif (Date.now() < lastClicked + 300) {\n\t\t\t\t\tdragged = undefined;\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tlastClicked = Date.now();\n\t\t\t\t\t\tconst bounds = line.getWordBounds(curse);\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: bounds[0]},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: bounds[1]},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstart: {line: linePos, index: 0},\n\t\t\t\t\t\t\t\t\tend: {line: linePos, index: line.length()},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlastClicked = Date.now();\n\t\t\t\tconst cursor = {line: linePos, index: curse};\n\t\t\t\tif (!e.altKey) {\n\t\t\t\t\tthis.cursor = {possitions: [cursor]};\n\t\t\t\t} else {\n\t\t\t\t\tif (\"possitions\" in this.cursor) {\n\t\t\t\t\t\tthis.cursor.possitions.push(cursor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cursor.highlights.push({\n\t\t\t\t\t\t\tstart: cursor,\n\t\t\t\t\t\t\tend: structuredClone(cursor),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.collectCurors();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.renderToCanvas(ctx);\n\t\t});\n\t\tc.addEventListener(\"mouseup\", () => {\n\t\t\tdragged = undefined;\n\t\t});\n\t\tc.addEventListener(\"mousemove\", (e) => {\n\t\t\tif (dragged) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.focusCursors();\n\t\t\t\tconst linePos = Math.min(\n\t\t\t\t\tMath.floor(e.offsetY / this.fontSize + this.scroll.linedown),\n\t\t\t\t\tthis.lines.length - 1,\n\t\t\t\t);\n\t\t\t\tconst line = this.lines[linePos];\n\t\t\t\tconst curse = line.moveCursor(\n\t\t\t\t\tMath.round((e.offsetX - this.widthNeeded()) / this.charWidth) - 1,\n\t\t\t\t\t0,\n\t\t\t\t);\n\t\t\t\tif (linePos !== dragged.line && dragged.index !== curse) {\n\t\t\t\t\tthis.cursor = {\n\t\t\t\t\t\thighlights: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstart: dragged,\n\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\tline: linePos,\n\t\t\t\t\t\t\t\t\tindex: curse,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t\tthis.renderToCanvas(ctx);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsetInterval(() => {\n\t\t\tthis.renderToCanvas(ctx);\n\t\t}, this.blinkInterval / 2);\n\t\tmut.observe(c);\n\t\tthis.renderToCanvas(ctx);\n\t}\n\tstatic editMap = new Map<string, Editor>();\n\tasync assemble() {\n\t\t//TODO I'm sure there's more I can do to make this much smaller in RAM\n\t\ttry {\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.startingAssembly() + \"\\n\\n\");\n\t\t\tlet emu: Symstem;\n\t\t\tif (this.dir && this.fileDir) {\n\t\t\t\tconst dirL = this.fileDir.split(\"/\");\n\t\t\t\tdirL.pop();\n\t\t\t\tconst dir = dirL.join(\"/\") + \"/\";\n\t\t\t\tconst build: [string, string][] = [[this.string(), this.fileDir]];\n\t\t\t\tfor await (const [name, thing] of this.dir.getAllInDir()) {\n\t\t\t\t\tif (thing instanceof Directory) continue;\n\t\t\t\t\tif (!name.endsWith(\".asm\")) continue;\n\t\t\t\t\tconst thisDir = dir + name;\n\t\t\t\t\tif (thisDir === this.fileDir) continue;\n\t\t\t\t\tconst editor = Editor.editMap.get(thisDir);\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\tbuild.push([editor.string(), thisDir]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuild.push([await thing.text(), thisDir]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst [ram, pc] = assemble(build);\n\t\t\t\temu = new Symstem(ram, this.console);\n\t\t\t\temu.pc = pc;\n\t\t\t} else {\n\t\t\t\tconst [ram, pc] = assemble([[this.string(), this.fileDir || this.fileName]]);\n\t\t\t\temu = new Symstem(ram, this.console);\n\t\t\t\temu.pc = pc;\n\t\t\t}\n\t\t\temu.intRegis[2] = 0x7fffeffcn;\n\t\t\tthis.console.addMessage(\"\\n\" + I18n.finishedAssembly() + \"\\n\\n\");\n\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", emu));\n\t\t} catch (e) {\n\t\t\tif (e instanceof AssemblError) {\n\t\t\t\tthis.dispatchEvent(new AssembleEvent(\"Assemble\", e));\n\t\t\t} else {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\tcreateEditor(): HTMLDivElement {\n\t\tconst area = document.createElement(\"div\");\n\t\tarea.classList.add(\"flexttb\", \"editor\");\n\t\tconst c = document.createElement(\"canvas\");\n\t\tarea.append(c);\n\t\tthis.ownCanvas(c);\n\t\treturn area;\n\t}\n}\nclass AssembleEvent extends Event {\n\tsys: Symstem | AssemblError;\n\tconstructor(code: string, sys: Symstem | AssemblError) {\n\t\tsuper(code);\n\t\tthis.sys = sys;\n\t}\n}\nexport {Editor, AssembleEvent};\n"],"names":["assemble","AssemblError","Symstem","I18n","Directory","Line","redispatched","WeakSet","window","addEventListener","event","has","e","ClipboardEvent","add","document","activeElement","dispatchEvent","Editor","EventTarget","lines","tabLength","cursor","possitions","line","index","scroll","linedown","charleft","console","fileName","fileDir","fontSize","past","future","dir","constructor","asm","proj","split","map","_","length","push","type","listener","options","height","charWidth","renderToCanvas","ctx","clearRect","canvas","width","Math","floor","font","measureText","textBaseline","widthNeeded","i","errored","fillStyle","y","fillRect","getStart","o1","o2","high","highlights","h","start","end","startx","endx","endline","maxWidth","moveCursor","cursors","blinkOffset","Date","now","blinkInterval","filter","drawLine","fillText","log","max","focusCursors","collectCurors","sort","a","b","array","getState","structuredClone","pushPast","string","str","join","castToHighlights","arr","pos","sortHighlights","sa","sb","prev","first","cur","castToCursorsPassive","giveError","error","castToCursorsDestructive","realLineIndex","j","destroyed","undefined","dline","deleteRanges","newLine","offset","pop","thing","fakeCurors","getFakeIndex","Event","save","shiftArrow","Error","key","out","ctrlKey","Infinity","min","copy","warn","strings","getRanges","ownCanvas","c","lastClicked","getContext","mut","ResizeObserver","box","parentElement","getBoundingClientRect","preventDefault","deltaY","passive","contentEditable","clipboardData","paste","getData","Set","newLines","newI","replace","toLowerCase","altKey","metaKey","startsWith","shiftKey","insert","orphaned","text","navigator","clipboard","writeText","dragged","focus","button","linePos","offsetY","curse","round","offsetX","bounds","getWordBounds","setInterval","observe","editMap","Map","addMessage","startingAssembly","emu","dirL","build","name","getAllInDir","endsWith","thisDir","editor","get","ram","pc","intRegis","finishedAssembly","AssembleEvent","createEditor","area","createElement","classList","append","sys","code"],"mappings":"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"}