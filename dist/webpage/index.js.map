{"version":3,"sources":["../../src/webpage/index.ts"],"sourcesContent":["import {AssemblError} from \"./assembler/assembler.js\";\nimport {Contextmenu} from \"./contextMenu.js\";\nimport {Editor} from \"./editor/editor.js\";\nimport {Console} from \"./emulator/console.js\";\nimport {Etab} from \"./executeTab/etab.js\";\nimport {I18n} from \"./i18n.js\";\nimport {Project} from \"./projects/project.js\";\nimport {ProjFiles} from \"./projects/projectFiles.js\";\nconst actionRow = document.getElementById(\"actionRow\");\nif (!actionRow) throw Error(\"action row not in document\");\nconst cons = new Console();\n//Waiting for the translations to load\nawait I18n.done;\nconst fileMenu = new Contextmenu(\"File\");\nfileMenu.addButton(\n\t() => I18n.file.new(),\n\t() => {\n\t\tnewFile.click();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.open(),\n\t() => {\n\t\topenNewFile();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.save(),\n\t() => {\n\t\tfocusedEditor.save();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAll(),\n\t() => {\n\t\teditors.map((_) => _.save());\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAs(),\n\t() => {\n\t\tdownloadEditor(focusedEditor);\n\t},\n);\n\nconst fileButton = document.createElement(\"button\");\nfileButton.textContent = I18n.file.file();\nactionRow.append(fileButton);\nfileMenu.bindContextmenu(fileButton, undefined, undefined, true);\n\nconst menu = new Contextmenu(\"run\");\n\nconst assemble = document.getElementById(\"assemble\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.assemble(),\n\t() => {\n\t\tassemble.click();\n\t},\n\t{\n\t\tenabled: () => !assemble.classList.contains(\"disabled\"),\n\t},\n);\n\nconst start = document.getElementById(\"start\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.run(),\n\t() => {\n\t\tstart.click();\n\t},\n\t{\n\t\tenabled: () => !start.classList.contains(\"disabled\"),\n\t},\n);\n\nconst step = document.getElementById(\"step\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.step(),\n\t() => {\n\t\tstep.click();\n\t},\n\t{\n\t\tenabled: () => !step.classList.contains(\"disabled\"),\n\t},\n);\n\nconst backStep = document.getElementById(\"backStep\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.backStep(),\n\t() => {\n\t\tbackStep.click();\n\t},\n\t{\n\t\tenabled: () => !backStep.classList.contains(\"disabled\"),\n\t},\n);\n\nconst reset = document.getElementById(\"reset\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.reset(),\n\t() => {\n\t\treset.click();\n\t},\n\t{\n\t\tenabled: () => !reset.classList.contains(\"disabled\"),\n\t},\n);\n\nconst runButton = document.createElement(\"button\");\nrunButton.textContent = I18n.run.run();\nactionRow.append(runButton);\nmenu.bindContextmenu(runButton, undefined, undefined, true);\n\nconst area = document.getElementById(\"area\") as HTMLElement;\nif (!area) throw Error(\"area not found\");\nlet editors: Editor[] = [];\n\nlet focusedEditor = editors[0];\n\nconst newFile = document.getElementById(\"newFile\") as HTMLImageElement;\nnewFile.onclick = () => {\n\tsystem.disable();\n\tconst editor = new Editor(\"\", `riscv${editors.length + 1}.asm`, cons, curProject?.dir);\n\tif (curProject) {\n\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t}\n\teditors.push(editor);\n\tfocusedEditor = editor;\n\teditArea();\n};\n\nassemble.onclick = () => {\n\tfocusedEditor.assemble();\n};\n\nconst editButton = document.getElementById(\"EditButton\") as HTMLButtonElement;\nconst executeButton = document.getElementById(\"ExecuteButton\") as HTMLButtonElement;\neditButton.onclick = () => {\n\teditArea();\n};\nexecuteButton.onclick = () => {\n\texecuteArea();\n};\nlet system = new Etab();\n\nconst buttons = new Map<Editor, HTMLButtonElement>();\nconst saved = new Map<Editor, boolean>();\n\nfunction checkIfReload() {\n\tfor (const [_, bool] of saved) {\n\t\tif (!bool) {\n\t\t\twindow.onbeforeunload = () => \"true\";\n\t\t\treturn;\n\t\t}\n\t}\n\twindow.onbeforeunload = null;\n}\nlet editAreadiv = document.createElement(\"div\");\nlet selectedTab: HTMLElement;\nasync function editArea() {\n\tconst regiArea = document.getElementById(\"regiArea\") as HTMLElement;\n\tconst tabs = document.createElement(\"div\");\n\ttabs.classList.add(\"tabStyle\");\n\teditButton.classList.add(\"selected\");\n\texecuteButton.classList.remove(\"selected\");\n\tif (projFile) {\n\t\tconst html = await projFile.createHTML();\n\t\tregiArea.innerHTML = \"\";\n\t\tregiArea.append(html);\n\t} else {\n\t\tregiArea.innerHTML = \"\";\n\t}\n\tarea.innerHTML = \"\";\n\tarea.append(tabs);\n\tif (editors.length !== 0) {\n\t\tfor (const editor of editors) {\n\t\t\tconst bu = buttons.get(editor);\n\t\t\tif (bu) {\n\t\t\t\tif (editor === focusedEditor) {\n\t\t\t\t\tbu.click();\n\t\t\t\t}\n\t\t\t\ttabs.append(bu);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst button = document.createElement(\"button\");\n\t\t\tbuttons.set(editor, button);\n\t\t\tbutton.textContent = editor.fileName;\n\t\t\ttabs.append(button);\n\n\t\t\tbutton.addEventListener(\"mousedown\", (e) => {\n\t\t\t\tif (e.button === 1) {\n\t\t\t\t\tconst saving = saved.get(editor);\n\t\t\t\t\tif (!saving) {\n\t\t\t\t\t\tif (!confirm(I18n.unsaved())) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbutton.remove();\n\t\t\t\t\tbuttons.delete(editor);\n\t\t\t\t\teditors = editors.filter((_) => _ != editor);\n\t\t\t\t\tif (editor.fileDir) {\n\t\t\t\t\t\tEditor.editMap.delete(editor.fileDir);\n\t\t\t\t\t}\n\t\t\t\t\tif (editor == focusedEditor) {\n\t\t\t\t\t\tfocusedEditor = editors[0];\n\t\t\t\t\t\teditArea();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbutton.addEventListener(\"click\", () => {\n\t\t\t\tif (focusedEditor !== editor) {\n\t\t\t\t\tsystem.disable();\n\t\t\t\t}\n\t\t\t\tfocusedEditor = editor;\n\t\t\t\tif (selectedTab) {\n\t\t\t\t\tselectedTab.classList.remove(\"selected\");\n\t\t\t\t}\n\t\t\t\teditAreadiv.remove();\n\t\t\t\teditAreadiv = editor.createEditor();\n\t\t\t\tarea.append(editAreadiv);\n\t\t\t\tbutton.classList.add(\"selected\");\n\t\t\t\tselectedTab = button;\n\t\t\t});\n\t\t\teditor.addEventListener(\"Assemble\", async (e) => {\n\t\t\t\tif (e.sys instanceof AssemblError) {\n\t\t\t\t\tif (e.sys.file === (editor.fileDir || editor.fileName)) {\n\t\t\t\t\t\tbutton.click();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\teditor.giveError(e.sys);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!curProject) throw new Error(\"wow, something really broke, not sure what\");\n\t\t\t\t\t\tlet editor = Editor.editMap.get(e.sys.file);\n\t\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\t\tconst file = await curProject.getFile(e.sys.file);\n\t\t\t\t\t\t\teditor = new Editor(await file.text(), file.name, cons, curProject?.dir);\n\t\t\t\t\t\t\tEditor.editMap.set(e.sys.file, editor);\n\t\t\t\t\t\t\teditor.fileDir = e.sys.file;\n\t\t\t\t\t\t\teditors.push(editor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfocusedEditor = editor;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\teditor.giveError(e.sys);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\teditArea();\n\t\t\t\t\t}\n\t\t\t\t\tcons.addMessage(e.sys.message, true);\n\t\t\t\t} else {\n\t\t\t\t\tsystem.handSystem(e.sys);\n\t\t\t\t\texecuteArea();\n\t\t\t\t}\n\t\t\t});\n\t\t\tsaved.set(editor, true);\n\t\t\tcheckIfReload();\n\t\t\teditor.addEventListener(\"save\", () => {\n\t\t\t\tbutton.textContent = editor.fileName;\n\t\t\t\tsaved.set(editor, true);\n\t\t\t\tcheckIfReload();\n\t\t\t\tif (curProject) {\n\t\t\t\t\tcurProject.saveAsm(editor.fileName, editor.string());\n\t\t\t\t} else {\n\t\t\t\t\tdownloadEditor(editor);\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addEventListener(\"changed\", () => {\n\t\t\t\tbutton.textContent = editor.fileName + \"*\";\n\t\t\t\tsaved.set(editor, false);\n\t\t\t\tcheckIfReload();\n\t\t\t\tsystem.disable();\n\t\t\t});\n\t\t\tif (editor === focusedEditor) {\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t} else {\n\t\teditAreadiv.remove();\n\t\teditAreadiv = document.createElement(\"div\");\n\t\tarea.append(editAreadiv);\n\t\tconst h = document.createElement(\"h1\");\n\t\th.textContent = I18n.startScreen();\n\n\t\tconst project = document.createElement(\"button\");\n\t\tproject.textContent = I18n.startProject();\n\t\tproject.onclick = () => {\n\t\t\tnewProjectDialog();\n\t\t};\n\t\tconst file = document.createElement(\"button\");\n\t\tfile.textContent = I18n.openFile();\n\t\tfile.onclick = () => {\n\t\t\topenNewFile();\n\t\t};\n\n\t\teditAreadiv.classList.add(\"flexttb\", \"start\");\n\n\t\tconst projectList = document.createElement(\"div\");\n\t\tprojectList.classList.add(\"flexttb\", \"projectList\");\n\n\t\tconst openExisting = document.createElement(\"h4\");\n\t\topenExisting.textContent = I18n.project.openExisting();\n\n\t\t(async () => {\n\t\t\tfor await (const thing of Project.getProjects()) {\n\t\t\t\tconst button = document.createElement(\"button\");\n\t\t\t\tbutton.textContent = thing.name;\n\t\t\t\tbutton.onclick = () => {\n\t\t\t\t\topenProject(thing);\n\t\t\t\t};\n\t\t\t\tprojectList.append(button);\n\t\t\t}\n\t\t})();\n\n\t\teditAreadiv.append(h, project, file, openExisting, projectList);\n\t\tarea.append(editAreadiv);\n\t}\n}\nconst save = document.getElementById(\"save\") as HTMLElement;\nsave.onclick = () => {\n\tif (focusedEditor) {\n\t\tfocusedEditor.save();\n\t}\n};\nfunction newProjectDialog() {\n\tconst dialog = document.createElement(\"dialog\");\n\tdocument.body.append(dialog);\n\tconst p1 = document.createElement(\"h4\");\n\tp1.textContent = I18n.project.name();\n\tdialog.append(p1);\n\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"text\";\n\tdialog.append(input);\n\n\tconst submit = document.createElement(\"button\");\n\tsubmit.textContent = I18n.submit();\n\tdialog.append(submit);\n\tsubmit.onclick = async () => {\n\t\tconst name = input.value;\n\t\tif (name.length === 0) {\n\t\t\talert(I18n.project.pleaseEnterName());\n\t\t\treturn;\n\t\t}\n\t\tconst proj = await Project.checkName(name);\n\t\tif (proj) {\n\t\t\tdialog.remove();\n\t\t\topenProject(proj);\n\t\t} else {\n\t\t\talert(I18n.project.nameTaken());\n\t\t\treturn;\n\t\t}\n\t};\n\n\tdialog.showModal();\n}\nfunction openNewFile() {\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"file\";\n\tinput.accept = \".asm\";\n\tdocument.body.append(input);\n\tinput.click();\n\tinput.remove();\n\tinput.onchange = async () => {\n\t\tif (input.files && input.files.length) {\n\t\t\tlet newEditor: undefined | Editor;\n\t\t\tfor (const file of Array.from(input.files)) {\n\t\t\t\tconst editor = new Editor(await file.text(), file.name, cons, curProject?.dir);\n\t\t\t\tif (curProject) {\n\t\t\t\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\t\t\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t\t\t\t}\n\t\t\t\tnewEditor ||= editor;\n\t\t\t\teditors.push(editor);\n\t\t\t}\n\t\t\tif (newEditor) {\n\t\t\t\tfocusedEditor = newEditor;\n\t\t\t}\n\t\t\teditArea();\n\t\t}\n\t};\n}\nfunction downloadEditor(editor: Editor) {\n\tconst text = editor.string();\n\tconst fileName = editor.fileName;\n\tvar blob = new Blob([text]);\n\tvar a = document.createElement(\"a\");\n\ta.download = fileName;\n\ta.href = URL.createObjectURL(blob);\n\ta.dataset.downloadurl = [a.download, a.href].join(\":\");\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n\tsetTimeout(function () {\n\t\tURL.revokeObjectURL(a.href);\n\t}, 1500);\n}\nlet curProject: Project | undefined;\nlet projFile: ProjFiles | undefined;\nasync function openProject(proj: Project) {\n\tcurProject = proj;\n\tprojFile = new ProjFiles(proj);\n\tprojFile.addEventListener(\"open\", async (e) => {\n\t\tconst editor = Editor.editMap.get(`${proj.name}:${e.fileName}`);\n\t\tif (editor) {\n\t\t\tconst button = buttons.get(editor);\n\t\t\tif (button) {\n\t\t\t\tbutton.click();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tconst newEditor = new Editor(\n\t\t\tawait e.file.text(),\n\t\t\te.fileName.split(\"/\").at(-1),\n\t\t\tcons,\n\t\t\tcurProject?.dir,\n\t\t);\n\t\teditors.push(newEditor);\n\t\tfocusedEditor = newEditor;\n\t\tEditor.editMap.set(`${proj.name}:/${newEditor.fileName}`, newEditor);\n\t\tnewEditor.fileDir = `${proj.name}:/${newEditor.fileName}`;\n\t\tawait editArea();\n\t});\n\tfor await (const thing of proj.getAsm()) {\n\t\tconst editor = new Editor(await thing[1].text(), thing[0], cons, curProject?.dir);\n\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${proj.name}:/${editor.fileName}`;\n\t\tif (!focusedEditor) {\n\t\t\tfocusedEditor = editor;\n\t\t}\n\t\teditors.push(editor);\n\t}\n\teditArea();\n}\nconst consoleElm = document.getElementById(\"console\") as HTMLDivElement;\nconsoleElm.append(cons.makeHtml());\nfunction executeArea() {\n\tarea.innerHTML = \"\";\n\n\teditButton.classList.remove(\"selected\");\n\texecuteButton.classList.add(\"selected\");\n\tcons.messageIClick();\n\tarea.append(system.createHTML());\n}\neditArea();\n"],"names":["AssemblError","Contextmenu","Editor","Console","Etab","I18n","Project","ProjFiles","actionRow","document","getElementById","Error","cons","done","fileMenu","addButton","file","new","newFile","click","open","openNewFile","save","focusedEditor","saveAll","editors","map","_","saveAs","downloadEditor","fileButton","createElement","textContent","append","bindContextmenu","undefined","menu","assemble","run","enabled","classList","contains","start","step","backStep","reset","runButton","area","onclick","system","disable","editor","length","curProject","dir","editMap","set","name","fileName","fileDir","push","editArea","editButton","executeButton","executeArea","buttons","Map","saved","checkIfReload","bool","window","onbeforeunload","editAreadiv","selectedTab","regiArea","tabs","add","remove","projFile","html","createHTML","innerHTML","bu","get","button","addEventListener","e","saving","confirm","unsaved","delete","filter","createEditor","sys","giveError","console","error","getFile","text","addMessage","message","handSystem","saveAsm","string","h","startScreen","project","startProject","newProjectDialog","openFile","projectList","openExisting","thing","getProjects","openProject","dialog","body","p1","input","type","submit","value","alert","pleaseEnterName","proj","checkName","nameTaken","showModal","accept","onchange","files","newEditor","Array","from","blob","Blob","a","download","href","URL","createObjectURL","dataset","downloadurl","join","style","display","appendChild","removeChild","setTimeout","revokeObjectURL","split","at","getAsm","consoleElm","makeHtml","messageIClick"],"mappings":"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"}