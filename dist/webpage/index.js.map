{"version":3,"sources":["../../src/webpage/index.ts"],"sourcesContent":["import {AssemblError} from \"./assembler/assembler.js\";\nimport {Contextmenu} from \"./contextMenu.js\";\nimport {Editor} from \"./editor/editor.js\";\nimport {Console} from \"./emulator/console.js\";\nimport {Etab} from \"./executeTab/etab.js\";\nimport {I18n} from \"./i18n.js\";\nimport {Project} from \"./projects/project.js\";\nimport {ProjFiles} from \"./projects/projectFiles.js\";\nconst actionRow = document.getElementById(\"actionRow\");\nif (!actionRow) throw Error(\"action row not in document\");\nconst cons = new Console();\n//Waiting for the translations to load\nawait I18n.done;\nconst fileMenu = new Contextmenu(\"File\");\nfileMenu.addButton(\n\t() => I18n.file.new(),\n\t() => {\n\t\tnewFile.click();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.open(),\n\t() => {\n\t\topenNewFile();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.save(),\n\t() => {\n\t\tfocusedEditor.save();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAll(),\n\t() => {\n\t\teditors.map((_) => _.save());\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAs(),\n\t() => {\n\t\tdownloadEditor(focusedEditor);\n\t},\n);\n\nfileMenu.addButton(\n\t() => I18n.file.delete(),\n\tasync () => {\n\t\tif (curProject) {\n\t\t\tconst editor = focusedEditor;\n\t\t\tif (editor.fileDir) {\n\t\t\t\tif (!confirm(I18n.confirmDelete(editor.fileName))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst button = buttons.get(editor);\n\t\t\t\tif (button) button.remove();\n\t\t\t\tbuttons.delete(editor);\n\t\t\t\teditors = editors.filter((_) => _ != editor);\n\t\t\t\tif (editor.fileDir) {\n\t\t\t\t\tEditor.editMap.delete(editor.fileDir);\n\t\t\t\t}\n\t\t\t\tfocusedEditor = editors[0];\n\t\t\t\tawait editArea();\n\n\t\t\t\tawait curProject.delete(editor.fileDir);\n\t\t\t\tcreateRegiArea();\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\tvisable: () => !!curProject,\n\t},\n);\n\nconst fileButton = document.createElement(\"button\");\nfileButton.textContent = I18n.file.file();\nactionRow.append(fileButton);\nfileMenu.bindContextmenu(fileButton, undefined, undefined, true);\n\nconst menu = new Contextmenu(\"run\");\n\nconst assemble = document.getElementById(\"assemble\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.assemble(),\n\t() => {\n\t\tassemble.click();\n\t},\n\t{\n\t\tenabled: () => !assemble.classList.contains(\"disabled\"),\n\t},\n);\n\nconst start = document.getElementById(\"start\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.run(),\n\t() => {\n\t\tstart.click();\n\t},\n\t{\n\t\tenabled: () => !start.classList.contains(\"disabled\"),\n\t},\n);\n\nconst step = document.getElementById(\"step\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.step(),\n\t() => {\n\t\tstep.click();\n\t},\n\t{\n\t\tenabled: () => !step.classList.contains(\"disabled\"),\n\t},\n);\n\nconst backStep = document.getElementById(\"backStep\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.backStep(),\n\t() => {\n\t\tbackStep.click();\n\t},\n\t{\n\t\tenabled: () => !backStep.classList.contains(\"disabled\"),\n\t},\n);\n\nconst reset = document.getElementById(\"reset\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.reset(),\n\t() => {\n\t\treset.click();\n\t},\n\t{\n\t\tenabled: () => !reset.classList.contains(\"disabled\"),\n\t},\n);\n\nconst runButton = document.createElement(\"button\");\nrunButton.textContent = I18n.run.run();\nactionRow.append(runButton);\nmenu.bindContextmenu(runButton, undefined, undefined, true);\n\nconst area = document.getElementById(\"area\") as HTMLElement;\nif (!area) throw Error(\"area not found\");\nlet editors: Editor[] = [];\n\nlet focusedEditor = editors[0];\n\nconst newFile = document.getElementById(\"newFile\") as HTMLImageElement;\nnewFile.onclick = async () => {\n\tsystem.disable();\n\tlet i = 0;\n\tlet name = `riscv${editors.length + 1}.asm`;\n\tif (curProject) {\n\t\twhile (await curProject.checkName(curProject.name + \":/\" + name)) {\n\t\t\ti++;\n\t\t\tname = `riscv${editors.length + 1 + i}.asm`;\n\t\t}\n\t}\n\tconst editor = new Editor(\"\", name, cons, curProject?.dir);\n\tif (curProject) {\n\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t}\n\teditors.push(editor);\n\tfocusedEditor = editor;\n\teditArea();\n\tif (curProject) {\n\t\tsetTimeout(() => editor.save(), 100);\n\t}\n};\n\nassemble.onclick = () => {\n\tfocusedEditor.assemble();\n};\n\nconst editButton = document.getElementById(\"EditButton\") as HTMLButtonElement;\nconst executeButton = document.getElementById(\"ExecuteButton\") as HTMLButtonElement;\neditButton.onclick = () => {\n\teditArea();\n};\nexecuteButton.onclick = () => {\n\texecuteArea();\n};\nlet system = new Etab();\n\nconst buttons = new Map<Editor, HTMLButtonElement>();\nconst saved = new Map<Editor, boolean>();\n\nfunction checkIfReload() {\n\tfor (const [_, bool] of saved) {\n\t\tif (!bool) {\n\t\t\twindow.onbeforeunload = () => \"true\";\n\t\t\treturn;\n\t\t}\n\t}\n\twindow.onbeforeunload = null;\n}\nlet editAreadiv = document.createElement(\"div\");\nlet selectedTab: HTMLElement;\nasync function createRegiArea() {\n\tconst regiArea = document.getElementById(\"regiArea\") as HTMLElement;\n\tif (projFile) {\n\t\tconst html = await projFile.createHTML();\n\t\tregiArea.innerHTML = \"\";\n\t\tregiArea.append(html);\n\t} else {\n\t\tregiArea.innerHTML = \"\";\n\t}\n}\nasync function editArea() {\n\tconst tabs = document.createElement(\"div\");\n\ttabs.classList.add(\"tabStyle\");\n\teditButton.classList.add(\"selected\");\n\texecuteButton.classList.remove(\"selected\");\n\tawait createRegiArea();\n\tarea.innerHTML = \"\";\n\tarea.append(tabs);\n\tif (editors.length !== 0) {\n\t\tfor (const editor of editors) {\n\t\t\tconst bu = buttons.get(editor);\n\t\t\tif (bu) {\n\t\t\t\tif (editor === focusedEditor) {\n\t\t\t\t\tbu.click();\n\t\t\t\t}\n\t\t\t\ttabs.append(bu);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst button = document.createElement(\"button\");\n\t\t\tbuttons.set(editor, button);\n\t\t\tbutton.textContent = editor.fileName;\n\t\t\ttabs.append(button);\n\n\t\t\tbutton.addEventListener(\"mousedown\", (e) => {\n\t\t\t\tif (e.button === 1) {\n\t\t\t\t\tconst saving = saved.get(editor);\n\t\t\t\t\tif (!saving) {\n\t\t\t\t\t\tif (!confirm(I18n.unsaved())) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbutton.remove();\n\t\t\t\t\tbuttons.delete(editor);\n\t\t\t\t\teditors = editors.filter((_) => _ != editor);\n\t\t\t\t\tif (editor.fileDir) {\n\t\t\t\t\t\tEditor.editMap.delete(editor.fileDir);\n\t\t\t\t\t}\n\t\t\t\t\tif (editor == focusedEditor) {\n\t\t\t\t\t\tfocusedEditor = editors[0];\n\t\t\t\t\t\teditArea();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbutton.addEventListener(\"click\", () => {\n\t\t\t\tif (focusedEditor !== editor) {\n\t\t\t\t\tsystem.disable();\n\t\t\t\t}\n\t\t\t\tfocusedEditor = editor;\n\t\t\t\tif (selectedTab) {\n\t\t\t\t\tselectedTab.classList.remove(\"selected\");\n\t\t\t\t}\n\t\t\t\teditAreadiv.remove();\n\t\t\t\teditAreadiv = editor.createEditor();\n\t\t\t\tarea.append(editAreadiv);\n\t\t\t\tbutton.classList.add(\"selected\");\n\t\t\t\tselectedTab = button;\n\t\t\t});\n\t\t\teditor.addEventListener(\"Assemble\", async (e) => {\n\t\t\t\tif (e.sys instanceof AssemblError) {\n\t\t\t\t\tif (e.sys.file === (editor.fileDir || editor.fileName)) {\n\t\t\t\t\t\tbutton.click();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\teditor.giveError(e.sys);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!curProject) throw new Error(\"wow, something really broke, not sure what\");\n\t\t\t\t\t\tlet editor = Editor.editMap.get(e.sys.file);\n\t\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\t\tconst file = await curProject.getFile(e.sys.file);\n\t\t\t\t\t\t\teditor = new Editor(await file.text(), file.name, cons, curProject?.dir);\n\t\t\t\t\t\t\tEditor.editMap.set(e.sys.file, editor);\n\t\t\t\t\t\t\teditor.fileDir = e.sys.file;\n\t\t\t\t\t\t\teditors.push(editor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfocusedEditor = editor;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\teditor.giveError(e.sys);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\teditArea();\n\t\t\t\t\t}\n\t\t\t\t\tcons.addMessage(e.sys.message, true);\n\t\t\t\t} else {\n\t\t\t\t\tsystem.handSystem(e.sys);\n\t\t\t\t\texecuteArea();\n\t\t\t\t}\n\t\t\t});\n\t\t\tsaved.set(editor, true);\n\t\t\tcheckIfReload();\n\t\t\teditor.addEventListener(\"save\", async () => {\n\t\t\t\tbutton.textContent = editor.fileName;\n\t\t\t\tsaved.set(editor, true);\n\t\t\t\tcheckIfReload();\n\t\t\t\tif (curProject) {\n\t\t\t\t\tawait curProject.saveAsm(editor.fileName, editor.string());\n\t\t\t\t\tcreateRegiArea();\n\t\t\t\t} else {\n\t\t\t\t\tdownloadEditor(editor);\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addEventListener(\"changed\", () => {\n\t\t\t\tbutton.textContent = editor.fileName + \"*\";\n\t\t\t\tsaved.set(editor, false);\n\t\t\t\tcheckIfReload();\n\t\t\t\tsystem.disable();\n\t\t\t});\n\t\t\tif (editor === focusedEditor) {\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t} else {\n\t\teditAreadiv.remove();\n\t\teditAreadiv = document.createElement(\"div\");\n\t\tarea.append(editAreadiv);\n\t\tconst h = document.createElement(\"h1\");\n\t\th.textContent = I18n.startScreen();\n\n\t\tconst project = document.createElement(\"button\");\n\t\tproject.textContent = I18n.startProject();\n\t\tproject.onclick = () => {\n\t\t\tnewProjectDialog();\n\t\t};\n\t\tconst file = document.createElement(\"button\");\n\t\tfile.textContent = I18n.openFile();\n\t\tfile.onclick = () => {\n\t\t\topenNewFile();\n\t\t};\n\n\t\teditAreadiv.classList.add(\"flexttb\", \"start\");\n\n\t\tconst projectList = document.createElement(\"div\");\n\t\tprojectList.classList.add(\"flexttb\", \"projectList\");\n\n\t\tconst openExisting = document.createElement(\"h4\");\n\t\topenExisting.textContent = I18n.project.openExisting();\n\n\t\t(async () => {\n\t\t\tfor await (const thing of Project.getProjects()) {\n\t\t\t\tconst button = document.createElement(\"button\");\n\t\t\t\tbutton.textContent = thing.name;\n\t\t\t\tbutton.onclick = () => {\n\t\t\t\t\topenProject(thing);\n\t\t\t\t};\n\t\t\t\tprojectList.append(button);\n\t\t\t}\n\t\t})();\n\n\t\teditAreadiv.append(h, project, file, openExisting, projectList);\n\t\tarea.append(editAreadiv);\n\t}\n}\nconst save = document.getElementById(\"save\") as HTMLElement;\nsave.onclick = () => {\n\tif (focusedEditor) {\n\t\tfocusedEditor.save();\n\t}\n};\nfunction newProjectDialog() {\n\tconst dialog = document.createElement(\"dialog\");\n\tdocument.body.append(dialog);\n\tconst p1 = document.createElement(\"h4\");\n\tp1.textContent = I18n.project.name();\n\tdialog.append(p1);\n\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"text\";\n\tdialog.append(input);\n\n\tconst submit = document.createElement(\"button\");\n\tsubmit.textContent = I18n.submit();\n\tdialog.append(submit);\n\tsubmit.onclick = async () => {\n\t\tconst name = input.value;\n\t\tif (name.length === 0) {\n\t\t\talert(I18n.project.pleaseEnterName());\n\t\t\treturn;\n\t\t}\n\t\tconst proj = await Project.checkName(name);\n\t\tif (proj) {\n\t\t\tdialog.remove();\n\t\t\topenProject(proj);\n\t\t} else {\n\t\t\talert(I18n.project.nameTaken());\n\t\t\treturn;\n\t\t}\n\t};\n\n\tdialog.showModal();\n}\nfunction openNewFile() {\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"file\";\n\tinput.accept = \".asm\";\n\tdocument.body.append(input);\n\tinput.click();\n\tinput.remove();\n\tinput.onchange = async () => {\n\t\tif (input.files && input.files.length) {\n\t\t\tlet newEditor: undefined | Editor;\n\n\t\t\tconst editorList = Array.from(input.files).map(async (file) => {\n\t\t\t\tconst editor = new Editor(await file.text(), file.name, cons, curProject?.dir);\n\t\t\t\tif (curProject) {\n\t\t\t\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\t\t\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t\t\t\t}\n\t\t\t\tnewEditor ||= editor;\n\t\t\t\teditors.push(editor);\n\t\t\t\treturn editor;\n\t\t\t});\n\t\t\tconst arr = await Promise.all(editorList);\n\t\t\tif (newEditor) {\n\t\t\t\tfocusedEditor = newEditor;\n\t\t\t}\n\t\t\tawait editArea();\n\n\t\t\tif (curProject) {\n\t\t\t\tsetTimeout(() => arr.forEach((e) => e.save()), 100);\n\t\t\t}\n\t\t}\n\t};\n}\nfunction downloadEditor(editor: Editor) {\n\tconst text = editor.string();\n\tconst fileName = editor.fileName;\n\tvar blob = new Blob([text]);\n\tvar a = document.createElement(\"a\");\n\ta.download = fileName;\n\ta.href = URL.createObjectURL(blob);\n\ta.dataset.downloadurl = [a.download, a.href].join(\":\");\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n\tsetTimeout(function () {\n\t\tURL.revokeObjectURL(a.href);\n\t}, 1500);\n}\nlet curProject: Project | undefined;\nlet projFile: ProjFiles | undefined;\nasync function openProject(proj: Project) {\n\tcurProject = proj;\n\tprojFile = new ProjFiles(proj);\n\tprojFile.addEventListener(\"open\", async (e) => {\n\t\tconst editor = Editor.editMap.get(`${proj.name}:${e.fileName}`);\n\t\tif (editor) {\n\t\t\tconst button = buttons.get(editor);\n\t\t\tif (button) {\n\t\t\t\tbutton.click();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tconst newEditor = new Editor(\n\t\t\tawait e.file.text(),\n\t\t\te.fileName.split(\"/\").at(-1),\n\t\t\tcons,\n\t\t\tcurProject?.dir,\n\t\t);\n\t\teditors.push(newEditor);\n\t\tfocusedEditor = newEditor;\n\t\tEditor.editMap.set(`${proj.name}:/${newEditor.fileName}`, newEditor);\n\t\tnewEditor.fileDir = `${proj.name}:/${newEditor.fileName}`;\n\t\tawait editArea();\n\t});\n\tfor await (const thing of proj.getAsm()) {\n\t\tconst editor = new Editor(await thing[1].text(), thing[0], cons, curProject?.dir);\n\t\tEditor.editMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${proj.name}:/${editor.fileName}`;\n\t\tif (!focusedEditor) {\n\t\t\tfocusedEditor = editor;\n\t\t}\n\t\teditors.push(editor);\n\t}\n\teditArea();\n}\nconst consoleElm = document.getElementById(\"console\") as HTMLDivElement;\nconsoleElm.append(cons.makeHtml());\nfunction executeArea() {\n\tarea.innerHTML = \"\";\n\n\teditButton.classList.remove(\"selected\");\n\texecuteButton.classList.add(\"selected\");\n\tcons.messageIClick();\n\tarea.append(system.createHTML());\n}\neditArea();\n"],"names":["AssemblError","Contextmenu","Editor","Console","Etab","I18n","Project","ProjFiles","actionRow","document","getElementById","Error","cons","done","fileMenu","addButton","file","new","newFile","click","open","openNewFile","save","focusedEditor","saveAll","editors","map","_","saveAs","downloadEditor","delete","curProject","editor","fileDir","confirm","confirmDelete","fileName","button","buttons","get","remove","filter","editMap","editArea","createRegiArea","visable","fileButton","createElement","textContent","append","bindContextmenu","undefined","menu","assemble","run","enabled","classList","contains","start","step","backStep","reset","runButton","area","onclick","system","disable","i","name","length","checkName","dir","set","push","setTimeout","editButton","executeButton","executeArea","Map","saved","checkIfReload","bool","window","onbeforeunload","editAreadiv","selectedTab","regiArea","projFile","html","createHTML","innerHTML","tabs","add","bu","addEventListener","e","saving","unsaved","createEditor","sys","giveError","console","error","getFile","text","addMessage","message","handSystem","saveAsm","string","h","startScreen","project","startProject","newProjectDialog","openFile","projectList","openExisting","thing","getProjects","openProject","dialog","body","p1","input","type","submit","value","alert","pleaseEnterName","proj","nameTaken","showModal","accept","onchange","files","newEditor","editorList","Array","from","arr","Promise","all","forEach","blob","Blob","a","download","href","URL","createObjectURL","dataset","downloadurl","join","style","display","appendChild","removeChild","revokeObjectURL","split","at","getAsm","consoleElm","makeHtml","messageIClick"],"mappings":"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"}