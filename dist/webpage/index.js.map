{"version":3,"sources":["../../src/webpage/index.ts"],"sourcesContent":["import {AssemblError} from \"./assembler/assembler.js\";\nimport {Contextmenu} from \"./contextMenu.js\";\nimport {Editor} from \"./editor/editor.js\";\nimport {Console} from \"./emulator/console.js\";\nimport {Etab} from \"./executeTab/etab.js\";\nimport {I18n} from \"./i18n.js\";\nimport {Project} from \"./projects/project.js\";\nimport {ProjFiles} from \"./projects/projectFiles.js\";\nconst actionRow = document.getElementById(\"actionRow\");\nif (!actionRow) throw Error(\"action row not in document\");\nconst cons = new Console();\n//Waiting for the translations to load\nawait I18n.done;\nconst fileMenu = new Contextmenu(\"File\");\nfileMenu.addButton(\n\t() => I18n.file.new(),\n\t() => {\n\t\tnewFile.click();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.open(),\n\t() => {\n\t\topenNewFile();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.save(),\n\t() => {\n\t\tfocusedEditor.save();\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAll(),\n\t() => {\n\t\teditors.map((_) => _.save());\n\t},\n);\nfileMenu.addButton(\n\t() => I18n.file.saveAs(),\n\t() => {\n\t\tdownloadEditor(focusedEditor);\n\t},\n);\n\nconst fileButton = document.createElement(\"button\");\nfileButton.textContent = I18n.file.file();\nactionRow.append(fileButton);\nfileMenu.bindContextmenu(fileButton, undefined, undefined, true);\n\nconst menu = new Contextmenu(\"run\");\n\nconst assemble = document.getElementById(\"assemble\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.assemble(),\n\t() => {\n\t\tassemble.click();\n\t},\n\t{\n\t\tenabled: () => !assemble.classList.contains(\"disabled\"),\n\t},\n);\n\nconst start = document.getElementById(\"start\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.run(),\n\t() => {\n\t\tstart.click();\n\t},\n\t{\n\t\tenabled: () => !start.classList.contains(\"disabled\"),\n\t},\n);\n\nconst step = document.getElementById(\"step\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.step(),\n\t() => {\n\t\tstep.click();\n\t},\n\t{\n\t\tenabled: () => !step.classList.contains(\"disabled\"),\n\t},\n);\n\nconst backStep = document.getElementById(\"backStep\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.backStep(),\n\t() => {\n\t\tbackStep.click();\n\t},\n\t{\n\t\tenabled: () => !backStep.classList.contains(\"disabled\"),\n\t},\n);\n\nconst reset = document.getElementById(\"reset\") as HTMLElement;\nmenu.addButton(\n\t() => I18n.run.reset(),\n\t() => {\n\t\treset.click();\n\t},\n\t{\n\t\tenabled: () => !reset.classList.contains(\"disabled\"),\n\t},\n);\n\nconst runButton = document.createElement(\"button\");\nrunButton.textContent = I18n.run.run();\nactionRow.append(runButton);\nmenu.bindContextmenu(runButton, undefined, undefined, true);\n\nconst area = document.getElementById(\"area\") as HTMLElement;\nif (!area) throw Error(\"area not found\");\nlet editors: Editor[] = [];\n\nlet focusedEditor = editors[0];\n\nconst newFile = document.getElementById(\"newFile\") as HTMLImageElement;\nnewFile.onclick = () => {\n\tsystem.disable();\n\tconst editor = new Editor(\"\", `riscv${editors.length + 1}.asm`, cons, curProject?.dir);\n\tif (curProject) {\n\t\teditMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t}\n\teditors.push(editor);\n\tfocusedEditor = editor;\n\teditArea();\n};\n\nassemble.onclick = () => {\n\tfocusedEditor.assemble();\n};\n\nconst editButton = document.getElementById(\"EditButton\") as HTMLButtonElement;\nconst executeButton = document.getElementById(\"ExecuteButton\") as HTMLButtonElement;\neditButton.onclick = () => {\n\teditArea();\n};\nexecuteButton.onclick = () => {\n\texecuteArea();\n};\nlet system = new Etab();\n\nconst editMap = new Map<string, Editor>();\n\nconst buttons = new Map<Editor, HTMLButtonElement>();\nconst saved = new Map<Editor, boolean>();\nlet editAreadiv = document.createElement(\"div\");\nlet selectedTab: HTMLElement;\nasync function editArea() {\n\tconst regiArea = document.getElementById(\"regiArea\") as HTMLElement;\n\tconst tabs = document.createElement(\"div\");\n\ttabs.classList.add(\"tabStyle\");\n\teditButton.classList.add(\"selected\");\n\texecuteButton.classList.remove(\"selected\");\n\tif (projFile) {\n\t\tconst html = await projFile.createHTML();\n\t\tregiArea.innerHTML = \"\";\n\t\tregiArea.append(html);\n\t} else {\n\t\tregiArea.innerHTML = \"\";\n\t}\n\tarea.innerHTML = \"\";\n\tarea.append(tabs);\n\tif (editors.length !== 0) {\n\t\tfor (const editor of editors) {\n\t\t\tconst bu = buttons.get(editor);\n\t\t\tif (bu) {\n\t\t\t\tif (editor === focusedEditor) {\n\t\t\t\t\tbu.click();\n\t\t\t\t}\n\t\t\t\ttabs.append(bu);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst button = document.createElement(\"button\");\n\t\t\tbuttons.set(editor, button);\n\t\t\tbutton.textContent = editor.fileName;\n\t\t\ttabs.append(button);\n\n\t\t\tbutton.addEventListener(\"mousedown\", (e) => {\n\t\t\t\tif (e.button === 1) {\n\t\t\t\t\tconst saving = saved.get(editor);\n\t\t\t\t\tif (!saving) {\n\t\t\t\t\t\tif (!confirm(I18n.unsaved())) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbutton.remove();\n\t\t\t\t\tbuttons.delete(editor);\n\t\t\t\t\teditors = editors.filter((_) => _ != editor);\n\t\t\t\t\tif (editor.fileDir) {\n\t\t\t\t\t\teditMap.delete(editor.fileDir);\n\t\t\t\t\t}\n\t\t\t\t\tif (editor == focusedEditor) {\n\t\t\t\t\t\tfocusedEditor = editors[0];\n\t\t\t\t\t\teditArea();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbutton.addEventListener(\"click\", () => {\n\t\t\t\tif (focusedEditor !== editor) {\n\t\t\t\t\tsystem.disable();\n\t\t\t\t}\n\t\t\t\tfocusedEditor = editor;\n\t\t\t\tif (selectedTab) {\n\t\t\t\t\tselectedTab.classList.remove(\"selected\");\n\t\t\t\t}\n\t\t\t\teditAreadiv.remove();\n\t\t\t\teditAreadiv = editor.createEditor();\n\t\t\t\tarea.append(editAreadiv);\n\t\t\t\tbutton.classList.add(\"selected\");\n\t\t\t\tselectedTab = button;\n\t\t\t});\n\t\t\teditor.addEventListener(\"Assemble\", (e) => {\n\t\t\t\tif (e.sys instanceof AssemblError) {\n\t\t\t\t\tbutton.click();\n\t\t\t\t\ttry {\n\t\t\t\t\t\teditor.giveError(e.sys);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tcons.addMessage(e.sys.message, true);\n\t\t\t\t} else {\n\t\t\t\t\tsystem.handSystem(e.sys);\n\t\t\t\t\texecuteArea();\n\t\t\t\t}\n\t\t\t});\n\t\t\tsaved.set(editor, true);\n\t\t\teditor.addEventListener(\"save\", () => {\n\t\t\t\tbutton.textContent = editor.fileName;\n\t\t\t\tsaved.set(editor, true);\n\t\t\t\tif (curProject) {\n\t\t\t\t\tcurProject.saveAsm(editor.fileName, editor.string());\n\t\t\t\t} else {\n\t\t\t\t\tdownloadEditor(editor);\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addEventListener(\"changed\", () => {\n\t\t\t\tbutton.textContent = editor.fileName + \"*\";\n\t\t\t\tsaved.set(editor, false);\n\t\t\t\tsystem.disable();\n\t\t\t});\n\t\t\tif (editor === focusedEditor) {\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t} else {\n\t\teditAreadiv.remove();\n\t\teditAreadiv = document.createElement(\"div\");\n\t\tarea.append(editAreadiv);\n\t\tconst h = document.createElement(\"h1\");\n\t\th.textContent = I18n.startScreen();\n\n\t\tconst project = document.createElement(\"button\");\n\t\tproject.textContent = I18n.startProject();\n\t\tproject.onclick = () => {\n\t\t\tnewProjectDialog();\n\t\t};\n\t\tconst file = document.createElement(\"button\");\n\t\tfile.textContent = I18n.openFile();\n\t\tfile.onclick = () => {\n\t\t\topenNewFile();\n\t\t};\n\n\t\teditAreadiv.classList.add(\"flexttb\", \"start\");\n\n\t\tconst projectList = document.createElement(\"div\");\n\t\tprojectList.classList.add(\"flexttb\", \"projectList\");\n\n\t\tconst openExisting = document.createElement(\"h4\");\n\t\topenExisting.textContent = I18n.project.openExisting();\n\n\t\t(async () => {\n\t\t\tfor await (const thing of Project.getProjects()) {\n\t\t\t\tconst button = document.createElement(\"button\");\n\t\t\t\tbutton.textContent = thing.name;\n\t\t\t\tbutton.onclick = () => {\n\t\t\t\t\topenProject(thing);\n\t\t\t\t};\n\t\t\t\tprojectList.append(button);\n\t\t\t}\n\t\t})();\n\n\t\teditAreadiv.append(h, project, file, openExisting, projectList);\n\t\tarea.append(editAreadiv);\n\t}\n}\nconst save = document.getElementById(\"save\") as HTMLElement;\nsave.onclick = () => {\n\tif (focusedEditor) {\n\t\tfocusedEditor.save();\n\t}\n};\nfunction newProjectDialog() {\n\tconst dialog = document.createElement(\"dialog\");\n\tdocument.body.append(dialog);\n\tconst p1 = document.createElement(\"h4\");\n\tp1.textContent = I18n.project.name();\n\tdialog.append(p1);\n\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"text\";\n\tdialog.append(input);\n\n\tconst submit = document.createElement(\"button\");\n\tsubmit.textContent = I18n.submit();\n\tdialog.append(submit);\n\tsubmit.onclick = async () => {\n\t\tconst name = input.value;\n\t\tif (name.length === 0) {\n\t\t\talert(I18n.project.pleaseEnterName());\n\t\t\treturn;\n\t\t}\n\t\tconst proj = await Project.checkName(name);\n\t\tif (proj) {\n\t\t\tdialog.remove();\n\t\t\topenProject(proj);\n\t\t} else {\n\t\t\talert(I18n.project.nameTaken());\n\t\t\treturn;\n\t\t}\n\t};\n\n\tdialog.showModal();\n}\nfunction openNewFile() {\n\tconst input = document.createElement(\"input\");\n\tinput.type = \"file\";\n\tinput.accept = \".asm\";\n\tdocument.body.append(input);\n\tinput.click();\n\tinput.remove();\n\tinput.onchange = async () => {\n\t\tif (input.files && input.files.length) {\n\t\t\tlet newEditor: undefined | Editor;\n\t\t\tfor (const file of Array.from(input.files)) {\n\t\t\t\tconst editor = new Editor(await file.text(), file.name, cons, curProject?.dir);\n\t\t\t\tif (curProject) {\n\t\t\t\t\teditMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\t\t\t\teditor.fileDir = `${curProject.name}:/${editor.fileName}`;\n\t\t\t\t}\n\t\t\t\tnewEditor ||= editor;\n\t\t\t\teditors.push(editor);\n\t\t\t}\n\t\t\tif (newEditor) {\n\t\t\t\tfocusedEditor = newEditor;\n\t\t\t}\n\t\t\teditArea();\n\t\t}\n\t};\n}\nfunction downloadEditor(editor: Editor) {\n\tconst text = editor.string();\n\tconst fileName = editor.fileName;\n\tvar blob = new Blob([text]);\n\tvar a = document.createElement(\"a\");\n\ta.download = fileName;\n\ta.href = URL.createObjectURL(blob);\n\ta.dataset.downloadurl = [a.download, a.href].join(\":\");\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n\tsetTimeout(function () {\n\t\tURL.revokeObjectURL(a.href);\n\t}, 1500);\n}\nlet curProject: Project | undefined;\nlet projFile: ProjFiles | undefined;\nasync function openProject(proj: Project) {\n\tcurProject = proj;\n\tprojFile = new ProjFiles(proj);\n\tprojFile.addEventListener(\"open\", async (e) => {\n\t\tconst editor = editMap.get(`${proj.name}:${e.fileName}`);\n\t\tif (editor) {\n\t\t\tconst button = buttons.get(editor);\n\t\t\tif (button) {\n\t\t\t\tbutton.click();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tconst newEditor = new Editor(\n\t\t\tawait e.file.text(),\n\t\t\te.fileName.split(\"/\").at(-1),\n\t\t\tcons,\n\t\t\tcurProject?.dir,\n\t\t);\n\t\teditors.push(newEditor);\n\t\tfocusedEditor = newEditor;\n\t\teditMap.set(`${proj.name}:/${newEditor.fileName}`, newEditor);\n\t\tnewEditor.fileDir = `${proj.name}:/${newEditor.fileName}`;\n\t\tawait editArea();\n\t});\n\tfor await (const thing of proj.getAsm()) {\n\t\tconst editor = new Editor(await thing[1].text(), thing[0], cons, curProject?.dir);\n\t\teditMap.set(`${curProject.name}:/${editor.fileName}`, editor);\n\t\teditor.fileDir = `${proj.name}:/${editor.fileName}`;\n\t\tif (!focusedEditor) {\n\t\t\tfocusedEditor = editor;\n\t\t}\n\t\teditors.push(editor);\n\t}\n\teditArea();\n}\nconst consoleElm = document.getElementById(\"console\") as HTMLDivElement;\nconsoleElm.append(cons.makeHtml());\nfunction executeArea() {\n\tarea.innerHTML = \"\";\n\n\teditButton.classList.remove(\"selected\");\n\texecuteButton.classList.add(\"selected\");\n\tcons.messageIClick();\n\tarea.append(system.createHTML());\n}\neditArea();\n"],"names":["AssemblError","Contextmenu","Editor","Console","Etab","I18n","Project","ProjFiles","actionRow","document","getElementById","Error","cons","done","fileMenu","addButton","file","new","newFile","click","open","openNewFile","save","focusedEditor","saveAll","editors","map","_","saveAs","downloadEditor","fileButton","createElement","textContent","append","bindContextmenu","undefined","menu","assemble","run","enabled","classList","contains","start","step","backStep","reset","runButton","area","onclick","system","disable","editor","length","curProject","dir","editMap","set","name","fileName","fileDir","push","editArea","editButton","executeButton","executeArea","Map","buttons","saved","editAreadiv","selectedTab","regiArea","tabs","add","remove","projFile","html","createHTML","innerHTML","bu","get","button","addEventListener","e","saving","confirm","unsaved","delete","filter","createEditor","sys","giveError","console","error","addMessage","message","handSystem","saveAsm","string","h","startScreen","project","startProject","newProjectDialog","openFile","projectList","openExisting","thing","getProjects","openProject","dialog","body","p1","input","type","submit","value","alert","pleaseEnterName","proj","checkName","nameTaken","showModal","accept","onchange","files","newEditor","Array","from","text","blob","Blob","a","download","href","URL","createObjectURL","dataset","downloadurl","join","style","display","appendChild","removeChild","setTimeout","revokeObjectURL","split","at","getAsm","consoleElm","makeHtml","messageIClick"],"mappings":"AAAA,OAAQA,YAAY,KAAO,0BAA2B,AACtD,QAAQC,WAAW,KAAO,kBAAmB,AAC7C,QAAQC,MAAM,KAAO,oBAAqB,AAC1C,QAAQC,OAAO,KAAO,uBAAwB,AAC9C,QAAQC,IAAI,KAAO,sBAAuB,AAC1C,QAAQC,IAAI,KAAO,WAAY,AAC/B,QAAQC,OAAO,KAAO,uBAAwB,AAC9C,QAAQC,SAAS,KAAO,4BAA6B,CACrD,MAAMC,UAAYC,SAASC,cAAc,CAAC,aAC1C,GAAI,CAACF,UAAW,MAAMG,MAAM,8BAC5B,MAAMC,KAAO,IAAIT,OAEjB,OAAME,KAAKQ,IAAI,CACf,MAAMC,SAAW,IAAIb,YAAY,QACjCa,SAASC,SAAS,CACjB,IAAMV,KAAKW,IAAI,CAACC,GAAG,GACnB,KACCC,QAAQC,KAAK,EACd,GAEDL,SAASC,SAAS,CACjB,IAAMV,KAAKW,IAAI,CAACI,IAAI,GACpB,KACCC,aACD,GAEDP,SAASC,SAAS,CACjB,IAAMV,KAAKW,IAAI,CAACM,IAAI,GACpB,KACCC,cAAcD,IAAI,EACnB,GAEDR,SAASC,SAAS,CACjB,IAAMV,KAAKW,IAAI,CAACQ,OAAO,GACvB,KACCC,QAAQC,GAAG,CAAC,AAACC,GAAMA,EAAEL,IAAI,GAC1B,GAEDR,SAASC,SAAS,CACjB,IAAMV,KAAKW,IAAI,CAACY,MAAM,GACtB,KACCC,eAAeN,cAChB,GAGD,MAAMO,WAAarB,SAASsB,aAAa,CAAC,SAC1CD,CAAAA,WAAWE,WAAW,CAAG3B,KAAKW,IAAI,CAACA,IAAI,GACvCR,UAAUyB,MAAM,CAACH,YACjBhB,SAASoB,eAAe,CAACJ,WAAYK,UAAWA,UAAW,MAE3D,MAAMC,KAAO,IAAInC,YAAY,OAE7B,MAAMoC,SAAW5B,SAASC,cAAc,CAAC,YACzC0B,KAAKrB,SAAS,CACb,IAAMV,KAAKiC,GAAG,CAACD,QAAQ,GACvB,KACCA,SAASlB,KAAK,EACf,EACA,CACCoB,QAAS,IAAM,CAACF,SAASG,SAAS,CAACC,QAAQ,CAAC,WAC7C,GAGD,MAAMC,MAAQjC,SAASC,cAAc,CAAC,SACtC0B,KAAKrB,SAAS,CACb,IAAMV,KAAKiC,GAAG,CAACA,GAAG,GAClB,KACCI,MAAMvB,KAAK,EACZ,EACA,CACCoB,QAAS,IAAM,CAACG,MAAMF,SAAS,CAACC,QAAQ,CAAC,WAC1C,GAGD,MAAME,KAAOlC,SAASC,cAAc,CAAC,QACrC0B,KAAKrB,SAAS,CACb,IAAMV,KAAKiC,GAAG,CAACK,IAAI,GACnB,KACCA,KAAKxB,KAAK,EACX,EACA,CACCoB,QAAS,IAAM,CAACI,KAAKH,SAAS,CAACC,QAAQ,CAAC,WACzC,GAGD,MAAMG,SAAWnC,SAASC,cAAc,CAAC,YACzC0B,KAAKrB,SAAS,CACb,IAAMV,KAAKiC,GAAG,CAACM,QAAQ,GACvB,KACCA,SAASzB,KAAK,EACf,EACA,CACCoB,QAAS,IAAM,CAACK,SAASJ,SAAS,CAACC,QAAQ,CAAC,WAC7C,GAGD,MAAMI,MAAQpC,SAASC,cAAc,CAAC,SACtC0B,KAAKrB,SAAS,CACb,IAAMV,KAAKiC,GAAG,CAACO,KAAK,GACpB,KACCA,MAAM1B,KAAK,EACZ,EACA,CACCoB,QAAS,IAAM,CAACM,MAAML,SAAS,CAACC,QAAQ,CAAC,WAC1C,GAGD,MAAMK,UAAYrC,SAASsB,aAAa,CAAC,SACzCe,CAAAA,UAAUd,WAAW,CAAG3B,KAAKiC,GAAG,CAACA,GAAG,GACpC9B,UAAUyB,MAAM,CAACa,WACjBV,KAAKF,eAAe,CAACY,UAAWX,UAAWA,UAAW,MAEtD,MAAMY,KAAOtC,SAASC,cAAc,CAAC,QACrC,GAAI,CAACqC,KAAM,MAAMpC,MAAM,kBACvB,IAAIc,QAAoB,EAAE,CAE1B,IAAIF,cAAgBE,OAAO,CAAC,EAAE,CAE9B,MAAMP,QAAUT,SAASC,cAAc,CAAC,UACxCQ,CAAAA,QAAQ8B,OAAO,CAAG,KACjBC,OAAOC,OAAO,GACd,MAAMC,OAAS,IAAIjD,OAAO,GAAI,CAAC,KAAK,EAAEuB,QAAQ2B,MAAM,CAAG,EAAE,IAAI,CAAC,CAAExC,KAAMyC,YAAYC,KAClF,GAAID,WAAY,CACfE,QAAQC,GAAG,CAAC,CAAC,EAAEH,WAAWI,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,CAAEP,OACtDA,CAAAA,OAAOQ,OAAO,CAAG,CAAC,EAAEN,WAAWI,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,AAC1D,CACAjC,QAAQmC,IAAI,CAACT,QACb5B,cAAgB4B,OAChBU,UACD,CAEAxB,CAAAA,SAASW,OAAO,CAAG,KAClBzB,cAAcc,QAAQ,EACvB,EAEA,MAAMyB,WAAarD,SAASC,cAAc,CAAC,cAC3C,MAAMqD,cAAgBtD,SAASC,cAAc,CAAC,gBAC9CoD,CAAAA,WAAWd,OAAO,CAAG,KACpBa,UACD,CACAE,CAAAA,cAAcf,OAAO,CAAG,KACvBgB,aACD,EACA,IAAIf,OAAS,IAAI7C,KAEjB,MAAMmD,QAAU,IAAIU,IAEpB,MAAMC,QAAU,IAAID,IACpB,MAAME,MAAQ,IAAIF,IAClB,IAAIG,YAAc3D,SAASsB,aAAa,CAAC,OACzC,IAAIsC,YACJ,eAAeR,WACd,MAAMS,SAAW7D,SAASC,cAAc,CAAC,YACzC,MAAM6D,KAAO9D,SAASsB,aAAa,CAAC,OACpCwC,KAAK/B,SAAS,CAACgC,GAAG,CAAC,YACnBV,WAAWtB,SAAS,CAACgC,GAAG,CAAC,YACzBT,cAAcvB,SAAS,CAACiC,MAAM,CAAC,YAC/B,GAAIC,SAAU,CACb,MAAMC,KAAO,MAAMD,SAASE,UAAU,EACtCN,CAAAA,SAASO,SAAS,CAAG,GACrBP,SAASrC,MAAM,CAAC0C,KACjB,KAAO,CACNL,SAASO,SAAS,CAAG,EACtB,CACA9B,KAAK8B,SAAS,CAAG,GACjB9B,KAAKd,MAAM,CAACsC,MACZ,GAAI9C,QAAQ2B,MAAM,GAAK,EAAG,CACzB,IAAK,MAAMD,UAAU1B,QAAS,CAC7B,MAAMqD,GAAKZ,QAAQa,GAAG,CAAC5B,QACvB,GAAI2B,GAAI,CACP,GAAI3B,SAAW5B,cAAe,CAC7BuD,GAAG3D,KAAK,EACT,CACAoD,KAAKtC,MAAM,CAAC6C,IACZ,QACD,CACA,MAAME,OAASvE,SAASsB,aAAa,CAAC,UACtCmC,QAAQV,GAAG,CAACL,OAAQ6B,OACpBA,CAAAA,OAAOhD,WAAW,CAAGmB,OAAOO,QAAQ,CACpCa,KAAKtC,MAAM,CAAC+C,QAEZA,OAAOC,gBAAgB,CAAC,YAAa,AAACC,IACrC,GAAIA,EAAEF,MAAM,GAAK,EAAG,CACnB,MAAMG,OAAShB,MAAMY,GAAG,CAAC5B,QACzB,GAAI,CAACgC,OAAQ,CACZ,GAAI,CAACC,QAAQ/E,KAAKgF,OAAO,IAAK,CAC7B,MACD,CACD,CACAL,OAAOP,MAAM,GACbP,QAAQoB,MAAM,CAACnC,QACf1B,QAAUA,QAAQ8D,MAAM,CAAC,AAAC5D,GAAMA,GAAKwB,QACrC,GAAIA,OAAOQ,OAAO,CAAE,CACnBJ,QAAQ+B,MAAM,CAACnC,OAAOQ,OAAO,CAC9B,CACA,GAAIR,QAAU5B,cAAe,CAC5BA,cAAgBE,OAAO,CAAC,EAAE,CAC1BoC,UACD,CACD,CACD,GAEAmB,OAAOC,gBAAgB,CAAC,QAAS,KAChC,GAAI1D,gBAAkB4B,OAAQ,CAC7BF,OAAOC,OAAO,EACf,CACA3B,cAAgB4B,OAChB,GAAIkB,YAAa,CAChBA,YAAY7B,SAAS,CAACiC,MAAM,CAAC,WAC9B,CACAL,YAAYK,MAAM,GAClBL,YAAcjB,OAAOqC,YAAY,GACjCzC,KAAKd,MAAM,CAACmC,aACZY,OAAOxC,SAAS,CAACgC,GAAG,CAAC,YACrBH,YAAcW,MACf,GACA7B,OAAO8B,gBAAgB,CAAC,WAAY,AAACC,IACpC,GAAIA,EAAEO,GAAG,YAAYzF,aAAc,CAClCgF,OAAO7D,KAAK,GACZ,GAAI,CACHgC,OAAOuC,SAAS,CAACR,EAAEO,GAAG,CACvB,CAAE,KAAM,CACPE,QAAQC,KAAK,CAACV,EACf,CACAtE,KAAKiF,UAAU,CAACX,EAAEO,GAAG,CAACK,OAAO,CAAE,KAChC,KAAO,CACN7C,OAAO8C,UAAU,CAACb,EAAEO,GAAG,EACvBzB,aACD,CACD,GACAG,MAAMX,GAAG,CAACL,OAAQ,MAClBA,OAAO8B,gBAAgB,CAAC,OAAQ,KAC/BD,OAAOhD,WAAW,CAAGmB,OAAOO,QAAQ,CACpCS,MAAMX,GAAG,CAACL,OAAQ,MAClB,GAAIE,WAAY,CACfA,WAAW2C,OAAO,CAAC7C,OAAOO,QAAQ,CAAEP,OAAO8C,MAAM,GAClD,KAAO,CACNpE,eAAesB,OAChB,CACD,GACAA,OAAO8B,gBAAgB,CAAC,UAAW,KAClCD,OAAOhD,WAAW,CAAGmB,OAAOO,QAAQ,CAAG,IACvCS,MAAMX,GAAG,CAACL,OAAQ,OAClBF,OAAOC,OAAO,EACf,GACA,GAAIC,SAAW5B,cAAe,CAC7ByD,OAAO7D,KAAK,EACb,CACD,CACD,KAAO,CACNiD,YAAYK,MAAM,GAClBL,YAAc3D,SAASsB,aAAa,CAAC,OACrCgB,KAAKd,MAAM,CAACmC,aACZ,MAAM8B,EAAIzF,SAASsB,aAAa,CAAC,KACjCmE,CAAAA,EAAElE,WAAW,CAAG3B,KAAK8F,WAAW,GAEhC,MAAMC,QAAU3F,SAASsB,aAAa,CAAC,SACvCqE,CAAAA,QAAQpE,WAAW,CAAG3B,KAAKgG,YAAY,EACvCD,CAAAA,QAAQpD,OAAO,CAAG,KACjBsD,kBACD,EACA,MAAMtF,KAAOP,SAASsB,aAAa,CAAC,SACpCf,CAAAA,KAAKgB,WAAW,CAAG3B,KAAKkG,QAAQ,EAChCvF,CAAAA,KAAKgC,OAAO,CAAG,KACd3B,aACD,EAEA+C,YAAY5B,SAAS,CAACgC,GAAG,CAAC,UAAW,SAErC,MAAMgC,YAAc/F,SAASsB,aAAa,CAAC,OAC3CyE,YAAYhE,SAAS,CAACgC,GAAG,CAAC,UAAW,eAErC,MAAMiC,aAAehG,SAASsB,aAAa,CAAC,KAC5C0E,CAAAA,aAAazE,WAAW,CAAG3B,KAAK+F,OAAO,CAACK,YAAY,GAEpD,AAAC,CAAA,UACA,UAAW,MAAMC,SAASpG,QAAQqG,WAAW,GAAI,CAChD,MAAM3B,OAASvE,SAASsB,aAAa,CAAC,SACtCiD,CAAAA,OAAOhD,WAAW,CAAG0E,MAAMjD,IAAI,AAC/BuB,CAAAA,OAAOhC,OAAO,CAAG,KAChB4D,YAAYF,MACb,EACAF,YAAYvE,MAAM,CAAC+C,OACpB,CACD,CAAA,IAEAZ,YAAYnC,MAAM,CAACiE,EAAGE,QAASpF,KAAMyF,aAAcD,aACnDzD,KAAKd,MAAM,CAACmC,YACb,CACD,CACA,MAAM9C,KAAOb,SAASC,cAAc,CAAC,OACrCY,CAAAA,KAAK0B,OAAO,CAAG,KACd,GAAIzB,cAAe,CAClBA,cAAcD,IAAI,EACnB,CACD,EACA,SAASgF,mBACR,MAAMO,OAASpG,SAASsB,aAAa,CAAC,UACtCtB,SAASqG,IAAI,CAAC7E,MAAM,CAAC4E,QACrB,MAAME,GAAKtG,SAASsB,aAAa,CAAC,KAClCgF,CAAAA,GAAG/E,WAAW,CAAG3B,KAAK+F,OAAO,CAAC3C,IAAI,GAClCoD,OAAO5E,MAAM,CAAC8E,IAEd,MAAMC,MAAQvG,SAASsB,aAAa,CAAC,QACrCiF,CAAAA,MAAMC,IAAI,CAAG,OACbJ,OAAO5E,MAAM,CAAC+E,OAEd,MAAME,OAASzG,SAASsB,aAAa,CAAC,SACtCmF,CAAAA,OAAOlF,WAAW,CAAG3B,KAAK6G,MAAM,GAChCL,OAAO5E,MAAM,CAACiF,OACdA,CAAAA,OAAOlE,OAAO,CAAG,UAChB,MAAMS,KAAOuD,MAAMG,KAAK,CACxB,GAAI1D,KAAKL,MAAM,GAAK,EAAG,CACtBgE,MAAM/G,KAAK+F,OAAO,CAACiB,eAAe,IAClC,MACD,CACA,MAAMC,KAAO,MAAMhH,QAAQiH,SAAS,CAAC9D,MACrC,GAAI6D,KAAM,CACTT,OAAOpC,MAAM,GACbmC,YAAYU,KACb,KAAO,CACNF,MAAM/G,KAAK+F,OAAO,CAACoB,SAAS,IAC5B,MACD,CACD,EAEAX,OAAOY,SAAS,EACjB,CACA,SAASpG,cACR,MAAM2F,MAAQvG,SAASsB,aAAa,CAAC,QACrCiF,CAAAA,MAAMC,IAAI,CAAG,MACbD,CAAAA,MAAMU,MAAM,CAAG,OACfjH,SAASqG,IAAI,CAAC7E,MAAM,CAAC+E,OACrBA,MAAM7F,KAAK,GACX6F,MAAMvC,MAAM,EACZuC,CAAAA,MAAMW,QAAQ,CAAG,UAChB,GAAIX,MAAMY,KAAK,EAAIZ,MAAMY,KAAK,CAACxE,MAAM,CAAE,CACtC,IAAIyE,UACJ,IAAK,MAAM7G,QAAQ8G,MAAMC,IAAI,CAACf,MAAMY,KAAK,EAAG,CAC3C,MAAMzE,OAAS,IAAIjD,OAAO,MAAMc,KAAKgH,IAAI,GAAIhH,KAAKyC,IAAI,CAAE7C,KAAMyC,YAAYC,KAC1E,GAAID,WAAY,CACfE,QAAQC,GAAG,CAAC,CAAC,EAAEH,WAAWI,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,CAAEP,OACtDA,CAAAA,OAAOQ,OAAO,CAAG,CAAC,EAAEN,WAAWI,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,AAC1D,CACAmE,YAAc1E,OACd1B,QAAQmC,IAAI,CAACT,OACd,CACA,GAAI0E,UAAW,CACdtG,cAAgBsG,SACjB,CACAhE,UACD,CACD,CACD,CACA,SAAShC,eAAesB,MAAc,EACrC,MAAM6E,KAAO7E,OAAO8C,MAAM,GAC1B,MAAMvC,SAAWP,OAAOO,QAAQ,CAChC,IAAIuE,KAAO,IAAIC,KAAK,CAACF,KAAK,EAC1B,IAAIG,EAAI1H,SAASsB,aAAa,CAAC,IAC/BoG,CAAAA,EAAEC,QAAQ,CAAG1E,QACbyE,CAAAA,EAAEE,IAAI,CAAGC,IAAIC,eAAe,CAACN,KAC7BE,CAAAA,EAAEK,OAAO,CAACC,WAAW,CAAG,CAACN,EAAEC,QAAQ,CAAED,EAAEE,IAAI,CAAC,CAACK,IAAI,CAAC,IAClDP,CAAAA,EAAEQ,KAAK,CAACC,OAAO,CAAG,OAClBnI,SAASqG,IAAI,CAAC+B,WAAW,CAACV,GAC1BA,EAAEhH,KAAK,GACPV,SAASqG,IAAI,CAACgC,WAAW,CAACX,GAC1BY,WAAW,WACVT,IAAIU,eAAe,CAACb,EAAEE,IAAI,CAC3B,EAAG,KACJ,CACA,IAAIhF,WACJ,IAAIqB,SACJ,eAAekC,YAAYU,IAAa,EACvCjE,WAAaiE,KACb5C,SAAW,IAAInE,UAAU+G,MACzB5C,SAASO,gBAAgB,CAAC,OAAQ,MAAOC,IACxC,MAAM/B,OAASI,QAAQwB,GAAG,CAAC,CAAC,EAAEuC,KAAK7D,IAAI,CAAC,CAAC,EAAEyB,EAAExB,QAAQ,CAAC,CAAC,EACvD,GAAIP,OAAQ,CACX,MAAM6B,OAASd,QAAQa,GAAG,CAAC5B,QAC3B,GAAI6B,OAAQ,CACXA,OAAO7D,KAAK,GACZ,MACD,CACD,CACA,MAAM0G,UAAY,IAAI3H,OACrB,MAAMgF,EAAElE,IAAI,CAACgH,IAAI,GACjB9C,EAAExB,QAAQ,CAACuF,KAAK,CAAC,KAAKC,EAAE,CAAC,CAAC,GAC1BtI,KACAyC,YAAYC,KAEb7B,QAAQmC,IAAI,CAACiE,WACbtG,cAAgBsG,UAChBtE,QAAQC,GAAG,CAAC,CAAC,EAAE8D,KAAK7D,IAAI,CAAC,EAAE,EAAEoE,UAAUnE,QAAQ,CAAC,CAAC,CAAEmE,UACnDA,CAAAA,UAAUlE,OAAO,CAAG,CAAC,EAAE2D,KAAK7D,IAAI,CAAC,EAAE,EAAEoE,UAAUnE,QAAQ,CAAC,CAAC,AACzD,OAAMG,UACP,GACA,UAAW,MAAM6C,SAASY,KAAK6B,MAAM,GAAI,CACxC,MAAMhG,OAAS,IAAIjD,OAAO,MAAMwG,KAAK,CAAC,EAAE,CAACsB,IAAI,GAAItB,KAAK,CAAC,EAAE,CAAE9F,KAAMyC,YAAYC,KAC7EC,QAAQC,GAAG,CAAC,CAAC,EAAEH,WAAWI,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,CAAEP,OACtDA,CAAAA,OAAOQ,OAAO,CAAG,CAAC,EAAE2D,KAAK7D,IAAI,CAAC,EAAE,EAAEN,OAAOO,QAAQ,CAAC,CAAC,CACnD,GAAI,CAACnC,cAAe,CACnBA,cAAgB4B,MACjB,CACA1B,QAAQmC,IAAI,CAACT,OACd,CACAU,UACD,CACA,MAAMuF,WAAa3I,SAASC,cAAc,CAAC,WAC3C0I,WAAWnH,MAAM,CAACrB,KAAKyI,QAAQ,IAC/B,SAASrF,cACRjB,KAAK8B,SAAS,CAAG,GAEjBf,WAAWtB,SAAS,CAACiC,MAAM,CAAC,YAC5BV,cAAcvB,SAAS,CAACgC,GAAG,CAAC,YAC5B5D,KAAK0I,aAAa,GAClBvG,KAAKd,MAAM,CAACgB,OAAO2B,UAAU,GAC9B,CACAf"}