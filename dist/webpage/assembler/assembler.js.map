{"version":3,"sources":["../../../src/webpage/assembler/assembler.ts"],"sourcesContent":["import {Ram} from \"../emulator/ram.js\";\nimport {I18n} from \"../i18n.js\";\nimport {parseLine} from \"./parser.js\";\nimport {instructions, registerNames} from \"../fetches.js\";\n\nconst regNames = new Map<string, {type: \"register\"; number: number; floating: boolean}>([\n\t...registerNames.int\n\t\t.map((_, i) => {\n\t\t\treturn _.map(\n\t\t\t\t(_) =>\n\t\t\t\t\t[\n\t\t\t\t\t\t_,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"register\",\n\t\t\t\t\t\t\tnumber: i,\n\t\t\t\t\t\t\tfloating: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t] as [string, {type: \"register\"; number: number; floating: boolean}],\n\t\t\t);\n\t\t})\n\t\t.flat(1),\n\t...registerNames.float\n\t\t.map((_, i) => {\n\t\t\treturn _.map(\n\t\t\t\t(_) =>\n\t\t\t\t\t[\n\t\t\t\t\t\t_,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"register\",\n\t\t\t\t\t\t\tnumber: i,\n\t\t\t\t\t\t\tfloating: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t] as [string, {type: \"register\"; number: number; floating: boolean}],\n\t\t\t);\n\t\t})\n\t\t.flat(1),\n]);\nconst instMap = new Map(\n\tinstructions.map((_) => {\n\t\tconst name = _.name;\n\t\treturn [name, _];\n\t}),\n);\n\ntype symbolType =\n\t| {\n\t\t\tcontent: string;\n\t\t\ttype: \"variable\" | \"label\";\n\t  }\n\t| {\n\t\t\tcontent: string;\n\t\t\ttype: \"string\";\n\t  }\n\t| {\n\t\t\ttype: \"register\";\n\t\t\tnumber: number;\n\t\t\tfloating: boolean;\n\t  }\n\t| {\n\t\t\tcontent: string;\n\t\t\ttype: \"instruction\";\n\t  }\n\t| {\n\t\t\ttype: \"directive\";\n\t\t\tcontent: string;\n\t  }\n\t| {\n\t\t\ttype: \"unknown\";\n\t\t\tcontent: string;\n\t  }\n\t| {\n\t\t\ttype: \"parentheses\";\n\t\t\tcontains: symbolType[];\n\t  }\n\t| {\n\t\t\ttype: \"int\";\n\t\t\tcontent: bigint;\n\t  }\n\t| {\n\t\t\ttype: \"float\";\n\t\t\tcontent: number;\n\t  };\nclass AssemblError extends Error {\n\treadonly line: number;\n\treadonly file: string;\n\tconstructor(reason: string, line: number, file: string) {\n\t\tsuper(reason);\n\t\tthis.line = line;\n\t\tthis.file = file;\n\t}\n}\ntype linkerInfo = Map<\n\tnumber,\n\t{\n\t\tlabel: string;\n\t\ttype: \"dword\" | \"word\" | \"byte\" | \"half\" | \"I\" | \"RI\" | \"S\" | \"RS\" | \"B\" | \"U\" | \"AU\" | \"J\";\n\t\tline: number;\n\t\tfile: string;\n\t}\n>;\ntype labelMap = Map<string, number>;\nfunction assemble(files: [string, string][]) {\n\tconst textView = new DataView(new ArrayBuffer(1 << 22));\n\tlet textIndex = 0;\n\n\tconst dataView = new DataView(new ArrayBuffer(1 << 22));\n\tlet dataIndex = 0;\n\n\tconst globalDataLabels: linkerInfo = new Map();\n\tconst globalLabelMap: labelMap = new Map();\n\n\tfunction link(labelMap: labelMap, dataLables: linkerInfo, globalRun = false) {\n\t\tconst ram = new Ram(dataView, textView, [dataIndex, textIndex]);\n\n\t\tfor (const [address, thing] of dataLables) {\n\t\t\tconst label = labelMap.get(thing.label);\n\n\t\t\tif (!label) {\n\t\t\t\tif (globalRun) {\n\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\tI18n.errors.unmatchedLabel(thing.line + \"\", thing.label),\n\t\t\t\t\t\tthing.line,\n\t\t\t\t\t\tthing.file,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tglobalDataLabels.set(address, thing);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (thing.type) {\n\t\t\t\tcase \"byte\":\n\t\t\t\t\tram.setInt8(address, label);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"half\":\n\t\t\t\t\tram.setInt16(address, label);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"word\":\n\t\t\t\t\tram.setInt32(address, label);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"dword\":\n\t\t\t\t\tram.setBigInt64(address, label);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"U\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tram.setInt32(address, (label & 0xfffff000) | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"AU\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tlet offset = label - address;\n\t\t\t\t\tif ((offset & 0xfff) > 2047) offset += 0x1000;\n\t\t\t\t\tram.setInt32(address, (offset & 0xfffff000) | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"I\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tram.setInt32(address, ((label & 0xfff) << 20) | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"RI\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tram.setInt32(address, (((label - address + 4) & 0xfff) << 20) | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"B\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tconst offset = label - address;\n\t\t\t\t\tif (offset & 1) {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.evilJump(thing.line + \"\"), thing.line, thing.file);\n\t\t\t\t\t}\n\t\t\t\t\tconst evil =\n\t\t\t\t\t\t((offset & 0b11110) << 7) |\n\t\t\t\t\t\t((offset & 0b11111100000) << 20) |\n\t\t\t\t\t\t((offset & 0b100000000000) >>> 4) |\n\t\t\t\t\t\t((offset & 0b1000000000000) << 19);\n\t\t\t\t\tconsole.log((evil >>> 0).toString(2).padStart(32, \"0\"), offset.toString(16));\n\t\t\t\t\tram.setInt32(address, evil | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"J\": {\n\t\t\t\t\tconst inst = ram.getInt32(address);\n\t\t\t\t\tconst offset = label - address;\n\t\t\t\t\tif (offset & 1) {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.evilJump(thing.line + \"\"), thing.line, thing.file);\n\t\t\t\t\t}\n\t\t\t\t\tconst evil =\n\t\t\t\t\t\t((offset & 0b11111111110) << 20) ^\n\t\t\t\t\t\t((offset & 0b100000000000) << 9) ^\n\t\t\t\t\t\t(offset & 0b11111111000000000000) ^\n\t\t\t\t\t\t((offset & 0b100000000000000000000) << 11);\n\t\t\t\t\tconsole.log((evil >>> 0).toString(2).padStart(32, \"0\"), offset.toString(16));\n\t\t\t\t\tram.setInt32(address, evil | inst);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\"Internal error, fix me unhandled linking case:\" + thing.type,\n\t\t\t\t\t\tNaN,\n\t\t\t\t\t\tthing.file,\n\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn ram;\n\t}\n\tfor (const [code, file] of files) {\n\t\tfunction getCurAddress() {\n\t\t\tif (place == \"data\") {\n\t\t\t\treturn dataIndex + 0x10010000;\n\t\t\t} else if (place == \"text\") {\n\t\t\t\treturn textIndex + 0x00400000;\n\t\t\t} else {\n\t\t\t\tthrow new AssemblError(\"internal error please fix\", NaN, file);\n\t\t\t}\n\t\t}\n\t\tconst dataLables: linkerInfo = new Map();\n\t\tconst labelMap: labelMap = new Map();\n\n\t\tconst basicParsing = code.split(\"\\n\").map((_) => parseLine(_));\n\n\t\tlet i = 0;\n\t\tlet directive: \"double\" | \"float\" | \"dword\" | \"word\" | \"byte\" | \"half\" | \"ascii\" | \"asciz\" =\n\t\t\t\"word\";\n\t\tlet place: \"text\" | \"data\" = \"text\";\n\t\tfunction placeData(\n\t\t\tdata:\n\t\t\t\t| {type: \"int\"; content: bigint}\n\t\t\t\t| {type: \"float\"; content: number}\n\t\t\t\t| {type: \"string\"; content: string}\n\t\t\t\t| {type: \"unknown\"; content: string}\n\t\t\t\t| {\n\t\t\t\t\t\ttype: \"instruction\";\n\t\t\t\t\t\tcontent: number;\n\t\t\t\t\t\tlink?: {type: \"I\" | \"RI\" | \"S\" | \"RS\" | \"B\" | \"U\" | \"AU\" | \"J\"; label: string};\n\t\t\t\t  },\n\t\t) {\n\t\t\tif (place === \"text\" && data.type !== \"instruction\") {\n\t\t\t\tif (data.type === \"int\") {\n\t\t\t\t\tthrow new AssemblError(I18n.errors.dataInText(i + 1 + \"\", data.content + \"\"), i, file);\n\t\t\t\t}\n\t\t\t\tthrow new AssemblError(\n\t\t\t\t\tI18n.errors.dataInText(i + 1 + \"\", JSON.stringify(data.content)),\n\t\t\t\t\ti,\n\t\t\t\t\tfile,\n\t\t\t\t);\n\t\t\t}\n\t\t\tif ((directive === \"ascii\" || directive === \"asciz\") && place === \"data\") {\n\t\t\t\tif (data.type !== \"string\") {\n\t\t\t\t\tthrow new AssemblError(I18n.errors.notAString(i + 1 + \"\", data.type), i, file);\n\t\t\t\t}\n\t\t\t\tconst encode = new TextEncoder().encode(data.content);\n\t\t\t\tfor (const char of encode) {\n\t\t\t\t\tdataView.setUint8(dataIndex, char);\n\t\t\t\t\tdataIndex += 1;\n\t\t\t\t}\n\t\t\t\tif (directive === \"asciz\") {\n\t\t\t\t\tdataView.setUint8(dataIndex, 0);\n\t\t\t\t\tdataIndex += 1;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if (data.type === \"string\") {\n\t\t\t\tthrow new AssemblError(I18n.errors.stringOutsideOfDirrective(i + 1 + \"\"), i, file);\n\t\t\t}\n\t\t\tif (data.type === \"float\") {\n\t\t\t\tif (directive === \"float\") {\n\t\t\t\t\tdataView.setFloat32(dataIndex, data.content, true);\n\t\t\t\t\tdataIndex += 4;\n\t\t\t\t} else if (directive === \"double\") {\n\t\t\t\t\tdataView.setFloat64(dataIndex, data.content, true);\n\t\t\t\t\tdataIndex += 8;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new AssemblError(I18n.errors.wrongDirrectiveFloat(i + 1 + \"\"), i, file);\n\t\t\t\t}\n\t\t\t} else if (data.type == \"int\") {\n\t\t\t\tif (directive === \"byte\") {\n\t\t\t\t\tdataView.setUint8(dataIndex, Number(data.content & 0xffn));\n\t\t\t\t\tdataIndex += 1;\n\t\t\t\t} else if (directive === \"half\") {\n\t\t\t\t\tdataView.setUint16(dataIndex, Number(data.content & 0xffffn), true);\n\t\t\t\t\tdataIndex += 2;\n\t\t\t\t} else if (directive === \"word\") {\n\t\t\t\t\tdataView.setUint32(dataIndex, Number(data.content & 0xffffffffn), true);\n\t\t\t\t\tdataIndex += 4;\n\t\t\t\t} else if (directive === \"dword\") {\n\t\t\t\t\tdataView.setBigUint64(dataIndex, data.content, true);\n\t\t\t\t\tdataIndex += 8;\n\t\t\t\t} else if (directive === \"float\") {\n\t\t\t\t\tdataView.setFloat32(dataIndex, Number(data.content), true);\n\t\t\t\t\tdataIndex += 4;\n\t\t\t\t} else if (directive === \"double\") {\n\t\t\t\t\tdataView.setFloat64(dataIndex, Number(data.content), true);\n\t\t\t\t\tdataIndex += 8;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new AssemblError(\"internal error, please fix\", NaN, file);\n\t\t\t\t}\n\t\t\t} else if (data.type === \"unknown\") {\n\t\t\t\tif (directive == \"float\" || directive == \"double\") {\n\t\t\t\t\tthrow new AssemblError(I18n.errors.lableCantFloat(i + 1 + \"\"), i, file);\n\t\t\t\t} else if (directive !== \"ascii\" && directive != \"asciz\") {\n\t\t\t\t\tdataLables.set(getCurAddress(), {label: data.content, type: directive, line: i, file});\n\t\t\t\t\tif (directive === \"byte\") {\n\t\t\t\t\t\tdataIndex += 1;\n\t\t\t\t\t} else if (directive === \"half\") {\n\t\t\t\t\t\tdataIndex += 2;\n\t\t\t\t\t} else if (directive === \"word\") {\n\t\t\t\t\t\tdataIndex += 4;\n\t\t\t\t\t} else if (directive === \"dword\") {\n\t\t\t\t\t\tdataIndex += 8;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new AssemblError(\"internal error, please fix\", NaN, file);\n\t\t\t\t}\n\t\t\t} else if (data.type === \"instruction\") {\n\t\t\t\tif (data.link) {\n\t\t\t\t\tdataLables.set(getCurAddress(), {\n\t\t\t\t\t\tlabel: data.link.label,\n\t\t\t\t\t\ttype: data.link.type,\n\t\t\t\t\t\tline: i,\n\t\t\t\t\t\tfile,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (place === \"text\") {\n\t\t\t\t\ttextView.setUint32(textIndex, data.content, true);\n\t\t\t\t\ttextIndex += 4;\n\t\t\t\t} else {\n\t\t\t\t\tdataView.setUint32(dataIndex, data.content, true);\n\t\t\t\t\tdataIndex += 4;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new AssemblError(\"internal error, please fix\", NaN, file);\n\t\t\t}\n\t\t}\n\t\tconst globalLabelSet = new Set<[string, number]>();\n\t\tfor (const line of basicParsing) {\n\t\t\tlet s = 0;\n\t\t\tconst lineArr = [...line];\n\t\t\tfunction handleDirrective(data: {type: \"directive\"; content: string}) {\n\t\t\t\tswitch (data.content) {\n\t\t\t\t\tcase \"data\":\n\t\t\t\t\t\tplace = \"data\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"text\":\n\t\t\t\t\t\tplace = \"text\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ascii\":\n\t\t\t\t\tcase \"asciz\":\n\t\t\t\t\tcase \"double\":\n\t\t\t\t\tcase \"float\":\n\t\t\t\t\tcase \"byte\":\n\t\t\t\t\tcase \"word\":\n\t\t\t\t\tcase \"dword\":\n\t\t\t\t\tcase \"half\":\n\t\t\t\t\t\tif (place === \"text\") {\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.dataDirectiveInText(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdirective = data.content;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"global\":\n\t\t\t\t\tcase \"globl\":\n\t\t\t\t\t\tlet label = getNextSymbol();\n\t\t\t\t\t\tif (!label) {\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectGlobal(i + 1 + \"\", data.content), i, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\twhile (label) {\n\t\t\t\t\t\t\tif (label.type !== \"unknown\") {\n\t\t\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\t\t\tI18n.errors.expectedLabel(i + 1 + \"\", data.content),\n\t\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tglobalLabelSet.add([label.content, i]);\n\t\t\t\t\t\t\tlabel = getNextSymbol();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.unknownDirective(i + 1 + \"\", data.content), i, file);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst helperNext = (itterate = true) => {\n\t\t\t\treturn lineArr[(s += +itterate) - +itterate];\n\t\t\t};\n\t\t\tfunction getNextSymbol(\n\t\t\t\thelper = helperNext,\n\t\t\t\tvarMap = new Map<string, symbolType>(),\n\t\t\t): symbolType | undefined {\n\t\t\t\tconst symbol = helper();\n\t\t\t\tif (!symbol) return undefined;\n\t\t\t\tswitch (symbol.type) {\n\t\t\t\t\tcase \"comment\":\n\t\t\t\t\tcase \"space\":\n\t\t\t\t\t\treturn getNextSymbol(helper);\n\t\t\t\t\tcase \"invalidString\":\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.invalidString(i + 1 + \"\"), i, file);\n\t\t\t\t\tcase \"invalidChar\":\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.invalidChar(i + 1 + \"\"), i, file);\n\t\t\t\t\tcase \"char\":\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tsymbol.content.length > 3 &&\n\t\t\t\t\t\t\t!(symbol.content.length === 4 && symbol.content[1] == \"\\\\\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.CharTooLong(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (symbol.type === \"parentheses\") {\n\t\t\t\t\tif (symbol.content === \"(\") {\n\t\t\t\t\t\tconst innards: symbolType[] = [];\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\tif (helper(false).type === \"parentheses\") {\n\t\t\t\t\t\t\t\tif (helper(false).content === \")\") {\n\t\t\t\t\t\t\t\t\ts++;\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\ttype: \"parentheses\",\n\t\t\t\t\t\t\t\t\t\tcontains: innards,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.ParNoMatch(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst next = getNextSymbol(helper);\n\t\t\t\t\t\t\tif (!next) throw new AssemblError(I18n.errors.ParNoMatch(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\tinnards.push(next);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.ParNoMatch(i + 1 + \"\"), i, file);\n\t\t\t\t\t}\n\t\t\t\t} else if (symbol.type === \"char\") {\n\t\t\t\t\tconst char = [...symbol.content];\n\t\t\t\t\tchar.pop();\n\t\t\t\t\tchar.shift();\n\t\t\t\t\tconst str = JSON.parse(`\"${char.join(\"\")}\"`) as string;\n\t\t\t\t\tif (str.length !== 1) {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.CharTooLong(i + 1 + \"\"), i, file);\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"int\",\n\t\t\t\t\t\tcontent: BigInt(new TextEncoder().encode(str)[0]),\n\t\t\t\t\t};\n\t\t\t\t} else if (symbol.type === \"number\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: \"int\",\n\t\t\t\t\t\t\tcontent: BigInt(symbol.content),\n\t\t\t\t\t\t};\n\t\t\t\t\t} catch {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: \"float\",\n\t\t\t\t\t\t\tcontent: +symbol.content,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else if (symbol.type === \"label\") {\n\t\t\t\t\tconst arr = [...symbol.content];\n\t\t\t\t\tarr.pop();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"label\",\n\t\t\t\t\t\tcontent: arr.join(\"\"),\n\t\t\t\t\t};\n\t\t\t\t} else if (symbol.type === \"directive\") {\n\t\t\t\t\tconst arr = [...symbol.content];\n\t\t\t\t\tarr.shift();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"directive\",\n\t\t\t\t\t\tcontent: arr.join(\"\"),\n\t\t\t\t\t};\n\t\t\t\t} else if (symbol.type === \"string\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tcontent: JSON.parse(symbol.content) as string,\n\t\t\t\t\t};\n\t\t\t\t} else if (symbol.type === \"register\") {\n\t\t\t\t\tconst reg = regNames.get(symbol.content);\n\t\t\t\t\tif (reg === undefined) throw new AssemblError(\"internal error fix me\", NaN, file);\n\t\t\t\t\treturn reg;\n\t\t\t\t} else if (symbol.type === \"variable\") {\n\t\t\t\t\tconst arr = [...symbol.content];\n\t\t\t\t\tarr.shift();\n\t\t\t\t\tconst content = arr.join(\"\");\n\t\t\t\t\tconst mapped = varMap.get(content);\n\t\t\t\t\tif (mapped) {\n\t\t\t\t\t\treturn mapped;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"variable\",\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\ttype: symbol.type,\n\t\t\t\t\tcontent: symbol.content,\n\t\t\t\t};\n\t\t\t}\n\t\t\tfunction handleInstruction(data: {type: \"instruction\"; content: string}) {\n\t\t\t\tfunction get12Bit() {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.type !== \"int\")\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedInt(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.content < -2048n || sym.content > 2047n) {\n\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\tI18n.errors.OutOfBounts12bit(i + 1 + \"\", sym.content + \"\"),\n\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn Number(sym.content);\n\t\t\t\t}\n\t\t\t\tfunction getNumb() {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.type !== \"int\")\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedInt(i + 1 + \"\"), i, file);\n\t\t\t\t\treturn Number(sym.content);\n\t\t\t\t}\n\t\t\t\tfunction get5Bit() {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.type !== \"int\")\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedInt(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.content < 0n || sym.content > 31n) {\n\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\tI18n.errors.OutOfBounds5bit(i + 1 + \"\", sym.content + \"\"),\n\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn Number(sym.content);\n\t\t\t\t}\n\t\t\t\tfunction getRegi(float = false) {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.type !== \"register\")\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedRegi(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (!float && sym.floating) {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectIntReg(i + 1 + \"\"), i, file);\n\t\t\t\t\t} else if (float && !sym.floating) {\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectFloatReg(i + 1 + \"\"), i, file);\n\t\t\t\t\t}\n\t\t\t\t\treturn sym.number;\n\t\t\t\t}\n\t\t\t\tfunction getOffReg(type: \"I\" | \"S\", load: false | number) {\n\t\t\t\t\tlet sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tlet offset = 0n;\n\t\t\t\t\tswitch (sym.type) {\n\t\t\t\t\t\t//@ts-expect-error\n\t\t\t\t\t\tcase \"int\":\n\t\t\t\t\t\t\toffset = sym.content;\n\t\t\t\t\t\t\tconst prev = sym;\n\t\t\t\t\t\t\tsym = getNextSymbol();\n\t\t\t\t\t\t\tif (!sym) {\n\t\t\t\t\t\t\t\tif (prev.content > 2047n || prev.content < -2048n) {\n\t\t\t\t\t\t\t\t\tif (load !== false) {\n\t\t\t\t\t\t\t\t\t\tif (prev.content !== (prev.content & 0xffffffffn)) {\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\t\t\t\t\t0b0110111 |\n\t\t\t\t\t\t\t\t\t\t\t\t(load << 7) |\n\t\t\t\t\t\t\t\t\t\t\t\t((Number(prev.content & 0xffffffffn) >> 12) << 12),\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\treg: load,\n\t\t\t\t\t\t\t\t\t\t\toffset: Number(offset) & 0xfff,\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\t\t\t\t\tI18n.errors.OutOfBountsOff12bit(i + 1 + \"\", prev.content + \"\"),\n\t\t\t\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\treg: 0,\n\t\t\t\t\t\t\t\t\toffset: Number(offset) & 0xfff,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} else if (sym.type == \"parentheses\") {\n\t\t\t\t\t\t\t\t//fall\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectOffreg(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tcase \"parentheses\":\n\t\t\t\t\t\t\tif (sym.contains.length > 1) {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.TooManyPars(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t} else if (sym.contains.length === 0) {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.TooFewPars(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (sym.contains[0].type !== \"register\") {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectOffreg(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t} else if (sym.contains[0].floating) {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectIntReg(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\treg: sym.contains[0].number,\n\t\t\t\t\t\t\t\toffset: Number(offset) & 0xfff,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\tcase \"unknown\":\n\t\t\t\t\t\t\tif (load === false) {\n\t\t\t\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\t\t\t\tif (!sym)\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\t\t\t\tI18n.errors.InstructionNeededMoreParams(i + 1 + \"\"),\n\t\t\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (sym.type !== \"register\") {\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedRegi(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\t} else if (sym.floating) {\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectIntReg(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tload = sym.number;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\tcontent: 0b0010111 | (load << 7),\n\t\t\t\t\t\t\t\tlink: {type: \"AU\", label: sym.content},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tdataLables.set(getCurAddress(), {\n\t\t\t\t\t\t\t\tlabel: sym.content,\n\t\t\t\t\t\t\t\ttype: (\"R\" + type) as \"RI\" | \"RS\",\n\t\t\t\t\t\t\t\tline: i,\n\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\treg: load,\n\t\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectOffreg(i + 1 + \"\"), i, file);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfunction getLabel() {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (!sym)\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\tif (sym.type !== \"unknown\")\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedLabel(i + 1 + \"\"), i, file);\n\t\t\t\t\treturn sym.content;\n\t\t\t\t}\n\t\t\t\tfunction assertClear() {\n\t\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\t\tif (sym) throw new AssemblError(I18n.errors.tooManyArguments(i + 1 + \"\"), i, file);\n\t\t\t\t}\n\t\t\t\tconst info = instMap.get(data.content);\n\t\t\t\tif (!info) throw new AssemblError(\"internal error fix me\", i, file);\n\n\t\t\t\tswitch (info.type) {\n\t\t\t\t\tcase \"R\": {\n\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t(getRegi(info.args[0] === \"freg\") << 7) |\n\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t(getRegi(info.args[1] === \"freg\") << 15) |\n\t\t\t\t\t\t\t(info.funct7 << 25) |\n\t\t\t\t\t\t\t(getRegi(info.args[2] === \"freg\") << 20);\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tplaceData({type: \"instruction\", content: lay});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"I\": {\n\t\t\t\t\t\tif (info.args[1] === \"offreg\") {\n\t\t\t\t\t\t\tconst reg = getRegi(info.args[0] === \"freg\");\n\t\t\t\t\t\t\tconst off = getOffReg(\"I\", reg);\n\t\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t\t(reg << 7) |\n\t\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t\t(off.reg << 15) |\n\t\t\t\t\t\t\t\t(off.offset << 20);\n\t\t\t\t\t\t\tplaceData({type: \"instruction\", content: lay});\n\t\t\t\t\t\t} else if (info.pimm !== undefined) {\n\t\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t\t(getRegi(info.args[0] === \"freg\") << 7) |\n\t\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t\t(getRegi(info.args[1] === \"freg\") << 15) |\n\t\t\t\t\t\t\t\t(get5Bit() << 20) |\n\t\t\t\t\t\t\t\t(info.pimm << 25);\n\n\t\t\t\t\t\t\tplaceData({type: \"instruction\", content: lay});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t\t(getRegi(info.args[0] === \"freg\") << 7) |\n\t\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t\t(getRegi(info.args[1] === \"freg\") << 15) |\n\t\t\t\t\t\t\t\t(get12Bit() << 20);\n\n\t\t\t\t\t\t\tplaceData({type: \"instruction\", content: lay});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"S\": {\n\t\t\t\t\t\tconst reg = getRegi(info.args[0] === \"freg\");\n\t\t\t\t\t\tconst off = getOffReg(\"S\", reg);\n\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t((off.offset & 0b11111) << 7) |\n\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t(off.reg << 15) |\n\t\t\t\t\t\t\t(reg << 20) |\n\t\t\t\t\t\t\t((off.offset >> 5) << 25);\n\t\t\t\t\t\tplaceData({type: \"instruction\", content: lay});\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"B\": {\n\t\t\t\t\t\tconst lay =\n\t\t\t\t\t\t\tinfo.opcode |\n\t\t\t\t\t\t\t(info.funct3 << 12) |\n\t\t\t\t\t\t\t(getRegi(info.args[0] === \"freg\") << 15) |\n\t\t\t\t\t\t\t(getRegi(info.args[1] === \"freg\") << 20);\n\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\tcontent: lay,\n\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\ttype: \"B\",\n\t\t\t\t\t\t\t\tlabel: getLabel(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"J\": {\n\t\t\t\t\t\tconst lay = info.opcode | (getRegi() << 7);\n\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\tcontent: lay,\n\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\ttype: \"J\",\n\t\t\t\t\t\t\t\tlabel: getLabel(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"U\": {\n\t\t\t\t\t\tlet lay = info.opcode | (getRegi(info.args[0] === \"freg\") << 7);\n\t\t\t\t\t\tlet next = getNextSymbol();\n\t\t\t\t\t\tif (!next)\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.InstructionNeededMoreParams(i + 1 + \"\"), i, file);\n\t\t\t\t\t\tif (next.type === \"variable\" || next.type == \"unknown\") {\n\t\t\t\t\t\t\tif (next.type === \"variable\") {\n\t\t\t\t\t\t\t\tnext = getNextSymbol();\n\t\t\t\t\t\t\t\tif (!next)\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(\n\t\t\t\t\t\t\t\t\t\tI18n.errors.InstructionNeededMoreParams(i + 1 + \"\"),\n\t\t\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (next.type !== \"parentheses\")\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedLabelPars(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\tif (next.contains.length > 1)\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.TooManyPars(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\tif (next.contains.length < 1)\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.TooFewPars(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t\tnext = next.contains[0];\n\t\t\t\t\t\t\t\tif (next.type !== \"unknown\")\n\t\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.expectedLabel(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\tcontent: lay,\n\t\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\t\ttype: info.name === \"auipc\" ? \"AU\" : \"U\",\n\t\t\t\t\t\t\t\t\tlabel: next.content,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (next.type === \"int\") {\n\t\t\t\t\t\t\tif (next.content < -524288n || next.content > 524287n) {\n\t\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.OutOfBounts20bit(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlay = lay | (Number(next.content) << 12);\n\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\tcontent: lay,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new AssemblError(I18n.errors.UErrorType2(i + 1 + \"\"), i, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"W\": {\n\t\t\t\t\t\tplaceData({type: \"instruction\", content: info.code});\n\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"reallyfake\": {\n\t\t\t\t\t\tswitch (info.name) {\n\t\t\t\t\t\t\tcase \"la\": {\n\t\t\t\t\t\t\t\tconst reg = getRegi();\n\t\t\t\t\t\t\t\tconst label = getLabel();\n\t\t\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\tcontent: 0b0010111 | (reg << 7),\n\t\t\t\t\t\t\t\t\tlink: {type: \"AU\", label},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\tcontent: 0b0010011 | (reg << 7) | (reg << 15),\n\t\t\t\t\t\t\t\t\tlink: {type: \"RI\", label},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcase \"li\": {\n\t\t\t\t\t\t\t\tconst reg = getRegi();\n\t\t\t\t\t\t\t\tconst numb = getNumb();\n\t\t\t\t\t\t\t\tassertClear();\n\t\t\t\t\t\t\t\tif (numb <= 2047n && numb >= -2048) {\n\t\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\t\tcontent: 0b0010011 | (reg << 7) | (Number(numb) << 20),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else if (numb <= 2147483647n && numb >= -2147483648) {\n\t\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\t\tcontent: 0b0110111 | (reg << 7) | (Number(numb) & 0xfffff000),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tplaceData({\n\t\t\t\t\t\t\t\t\t\ttype: \"instruction\",\n\t\t\t\t\t\t\t\t\t\tcontent: 0b0010011 | (reg << 7) | ((Number(numb) & 0xfff) << 20),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile (true) {\n\t\t\t\tconst sym = getNextSymbol();\n\t\t\t\tif (!sym) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tswitch (sym.type) {\n\t\t\t\t\tcase \"unknown\":\n\t\t\t\t\tcase \"int\":\n\t\t\t\t\tcase \"float\":\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\tplaceData(sym);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"label\":\n\t\t\t\t\t\t//TODO check for conflicts\n\t\t\t\t\t\tlabelMap.set(sym.content, getCurAddress());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"register\":\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.loneRegister(i + 1 + \"\"), i, file);\n\t\t\t\t\tcase \"variable\":\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.varOutsideMacro(i + 1 + \"\"), i, file);\n\t\t\t\t\tcase \"parentheses\":\n\t\t\t\t\t\tthrow new AssemblError(I18n.errors.parenthesesWeird(i + 1 + \"\"), i, file);\n\t\t\t\t\tcase \"directive\":\n\t\t\t\t\t\thandleDirrective(sym);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"instruction\":\n\t\t\t\t\t\thandleInstruction(sym);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t//@ts-expect-error\n\t\t\t\t\t\tconsole.error(sym.type, \"not handled\");\n\t\t\t\t}\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tfor (const [thing, line] of globalLabelSet) {\n\t\t\tconst label = labelMap.get(thing);\n\t\t\tif (!label) {\n\t\t\t\tthrow new AssemblError(I18n.errors.unmatchedLabel(line + 1 + \"\", thing), line, file);\n\t\t\t}\n\t\t\tglobalLabelMap.set(thing, label);\n\t\t}\n\t\tlink(labelMap, dataLables);\n\t}\n\tconst ram = link(globalLabelMap, globalDataLabels, true);\n\tconst main = globalLabelMap.get(\"main\");\n\treturn [ram, main || 0x00400000] as [Ram, number];\n}\nexport {assemble, AssemblError};\n"],"names":["Ram","I18n","parseLine","instructions","registerNames","regNames","Map","int","map","_","i","type","number","floating","flat","float","instMap","name","AssemblError","Error","line","file","constructor","reason","assemble","files","textView","DataView","ArrayBuffer","textIndex","dataView","dataIndex","globalDataLabels","globalLabelMap","link","labelMap","dataLables","globalRun","ram","address","thing","label","get","errors","unmatchedLabel","set","setInt8","setInt16","setInt32","setBigInt64","inst","getInt32","offset","evilJump","evil","console","log","toString","padStart","NaN","code","getCurAddress","place","basicParsing","split","directive","placeData","data","dataInText","content","JSON","stringify","notAString","encode","TextEncoder","char","setUint8","stringOutsideOfDirrective","setFloat32","setFloat64","wrongDirrectiveFloat","Number","setUint16","setUint32","setBigUint64","lableCantFloat","globalLabelSet","Set","s","lineArr","handleDirrective","dataDirectiveInText","getNextSymbol","expectGlobal","expectedLabel","add","unknownDirective","helperNext","itterate","helper","varMap","symbol","undefined","invalidString","invalidChar","length","CharTooLong","innards","contains","ParNoMatch","next","push","pop","shift","str","parse","join","BigInt","arr","reg","mapped","handleInstruction","get12Bit","sym","InstructionNeededMoreParams","expectedInt","OutOfBounts12bit","getNumb","get5Bit","OutOfBounds5bit","getRegi","expectedRegi","expectIntReg","expectFloatReg","getOffReg","load","prev","OutOfBountsOff12bit","expectOffreg","TooManyPars","TooFewPars","getLabel","assertClear","tooManyArguments","info","lay","opcode","args","funct3","funct7","off","pimm","expectedLabelPars","OutOfBounts20bit","UErrorType2","numb","loneRegister","varOutsideMacro","parenthesesWeird","error","main"],"mappings":"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"}