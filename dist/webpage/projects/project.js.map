{"version":3,"sources":["../../../src/webpage/projects/project.ts"],"sourcesContent":["import {Directory} from \"../utils/utils.js\";\n\nclass Project {\n\tname: string;\n\tdir: Directory;\n\n\tprivate constructor(name: string, dir: Directory) {\n\t\tthis.name = name;\n\t\tthis.dir = dir;\n\t}\n\tasync createNewAsm(name: string) {\n\t\tawait this.dir.setString(\n\t\t\tname,\n\t\t\t`.global main\n.data\n\thello: .asciz \"hello world!\"\n\n.text\nmain:\n\tla a0 hello\n\tli a7 4\n\tecall\n\tli a7 10\n\tecall`,\n\t\t);\n\t\treturn [\n\t\t\tname,\n\t\t\t`.data\n\thello: .asciz \"hello world!\"\n\n.text\nmain:\n\tla a0 hello\n\tli a7 4\n\tecall\n\tli a7 10\n\tecall`,\n\t\t];\n\t}\n\tasync saveAsm(name: string, asm: string) {\n\t\treturn await this.dir.setString(name, asm);\n\t}\n\tasync *getAsm() {\n\t\tfor await (const thing of this.dir.getAllInDir()) {\n\t\t\tif (!(thing[1] instanceof Directory)) {\n\t\t\t\tyield thing as [string, File];\n\t\t\t}\n\t\t}\n\t}\n\tstatic async new(name: string): Promise<Project> {\n\t\tconst home = await Directory.home;\n\t\tconst dir = await home.getDir(name);\n\t\treturn new Project(name, dir);\n\t}\n\tstatic async checkName(name: string): Promise<false | Project> {\n\t\tconst home = await Directory.home;\n\t\tfor await (const [thingName, thing] of home.getAllInDir()) {\n\t\t\tif (thing instanceof Directory) {\n\t\t\t\tif (thingName === name) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst proj = await Project.new(name);\n\t\tawait proj.createNewAsm(\"main.asm\");\n\t\treturn proj;\n\t}\n\tstatic async *getProjects() {\n\t\tconst home = await Directory.home;\n\t\tfor await (const [thingName, thing] of home.getAllInDir()) {\n\t\t\tif (thing instanceof Directory) {\n\t\t\t\tyield new Project(thingName, thing);\n\t\t\t}\n\t\t}\n\t}\n\tasync getFile(str: string): Promise<File> {\n\t\tconst [name, strPath] = str.split(\":\");\n\t\tif (name !== this.name) console.error(\"something bad happened, but ignoring it\");\n\t\tconst path = strPath.split(\"/\").reverse();\n\t\tpath.pop();\n\t\tlet dir = this.dir;\n\t\twhile (path.length > 1) {\n\t\t\tdir = await dir.getDir(path.pop() as string);\n\t\t}\n\t\tconst file = await dir.getRawFile(path[0]);\n\t\tif (!file) {\n\t\t\tthrow Error(\"file somehow not found\");\n\t\t}\n\t\treturn file;\n\t}\n\tasync checkName(str: string): Promise<boolean> {\n\t\tconst [name, strPath] = str.split(\":\");\n\t\tif (name !== this.name) console.error(\"something bad happened, but ignoring it\");\n\t\tconst path = strPath.split(\"/\").reverse();\n\t\tpath.pop();\n\t\tlet dir = this.dir;\n\t\twhile (path.length > 1) {\n\t\t\tdir = await dir.getDir(path.pop() as string);\n\t\t}\n\t\tconst file = await dir.getRawFile(path[0]);\n\t\tconsole.log(!!file);\n\t\treturn !!file;\n\t}\n\tasync delete(str: string) {\n\t\tconst [name, strPath] = str.split(\":\");\n\t\tif (name !== this.name) console.error(\"something bad happened, but ignoring it\");\n\t\tconst path = strPath.split(\"/\").reverse();\n\t\tpath.pop();\n\t\tlet dir = this.dir;\n\t\twhile (path.length > 1) {\n\t\t\tdir = await dir.getDir(path.pop() as string);\n\t\t}\n\t\tconsole.log(dir);\n\t\tif (dir instanceof Directory) {\n\t\t\tawait dir.handle.removeEntry(path[0]);\n\t\t} else {\n\t\t\tconsole.error(\"internal error, please fix me sometime :P\");\n\t\t}\n\t}\n}\nexport {Project};\n"],"names":["Directory","Project","name","dir","createNewAsm","setString","saveAsm","asm","getAsm","thing","getAllInDir","new","home","getDir","checkName","thingName","proj","getProjects","getFile","str","strPath","split","console","error","path","reverse","pop","length","file","getRawFile","Error","log","delete","handle","removeEntry"],"mappings":"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"}