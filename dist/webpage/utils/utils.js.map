{"version":3,"sources":["../../../src/webpage/utils/utils.ts"],"sourcesContent":["setTheme();\nexport function setTheme() {\n\tlet name = localStorage.getItem(\"theme\");\n\tif (!name) {\n\t\tlocalStorage.setItem(\"theme\", \"Dark\");\n\t\tname = \"Dark\";\n\t}\n\tdocument.body.className = name + \"-theme\";\n}\n\nclass Directory {\n\tstatic home = this.createHome();\n\thandle: FileSystemDirectoryHandle;\n\twriteWorker?: Worker;\n\tprivate constructor(handle: FileSystemDirectoryHandle) {\n\t\tthis.handle = handle;\n\t}\n\tstatic async createHome(): Promise<Directory> {\n\t\tnavigator.storage.persist();\n\t\tconst home = new Directory(await navigator.storage.getDirectory());\n\t\treturn home;\n\t}\n\tasync *getAllInDir() {\n\t\tfor await (const [name, handle] of this.handle.entries()) {\n\t\t\tif (handle instanceof FileSystemDirectoryHandle) {\n\t\t\t\tyield [name, new Directory(handle)] as [string, Directory];\n\t\t\t} else if (handle instanceof FileSystemFileHandle) {\n\t\t\t\tyield [name, await handle.getFile()] as [string, File];\n\t\t\t} else {\n\t\t\t\tconsole.log(handle, \"oops :3\");\n\t\t\t}\n\t\t}\n\t\tconsole.log(\"done\");\n\t}\n\tasync getRawFileHandler(name: string) {\n\t\treturn await this.handle.getFileHandle(name);\n\t}\n\tasync getRawFile(name: string) {\n\t\ttry {\n\t\t\treturn await (await this.handle.getFileHandle(name)).getFile();\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\tasync getString(name: string): Promise<string | undefined> {\n\t\ttry {\n\t\t\treturn await (await this.getRawFile(name))!.text();\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\tinitWorker() {\n\t\tif (this.writeWorker) return this.writeWorker;\n\t\tthis.writeWorker = new Worker(\"/utils/dirrWorker.js\");\n\t\tthis.writeWorker.onmessage = (event) => {\n\t\t\tconst res = this.wMap.get(event.data[0]);\n\t\t\tthis.wMap.delete(event.data[0]);\n\t\t\tif (!res) throw new Error(\"Res is not defined here somehow\");\n\t\t\tres(event.data[1]);\n\t\t};\n\t\treturn this.writeWorker;\n\t}\n\twMap = new Map<number, (input: boolean) => void>();\n\tasync setStringWorker(name: FileSystemFileHandle, value: ArrayBuffer) {\n\t\tconst worker = this.initWorker();\n\t\tconst random = Math.random();\n\t\tworker.postMessage([name, value, random]);\n\t\treturn new Promise<boolean>((res) => {\n\t\t\tthis.wMap.set(random, res);\n\t\t});\n\t}\n\tasync setString(name: string, value: string): Promise<boolean> {\n\t\tconst file = await this.handle.getFileHandle(name, {create: true});\n\t\tconst contents = new TextEncoder().encode(value);\n\n\t\tif (file.createWritable as unknown) {\n\t\t\tconst stream = await file.createWritable({keepExistingData: false});\n\t\t\tawait stream.write(contents);\n\t\t\tawait stream.close();\n\t\t\treturn true;\n\t\t} else {\n\t\t\t//Curse you webkit!\n\t\t\treturn await this.setStringWorker(file, contents);\n\t\t}\n\t}\n\tasync getDir(name: string) {\n\t\treturn new Directory(await this.handle.getDirectoryHandle(name, {create: true}));\n\t}\n}\n\nexport {Directory};\n"],"names":["setTheme","name","localStorage","getItem","setItem","document","body","className","Directory","home","createHome","handle","writeWorker","navigator","storage","persist","getDirectory","getAllInDir","entries","FileSystemDirectoryHandle","FileSystemFileHandle","getFile","console","log","getRawFileHandler","getFileHandle","getRawFile","undefined","getString","text","initWorker","Worker","onmessage","event","res","wMap","get","data","delete","Error","Map","setStringWorker","value","worker","random","Math","postMessage","Promise","set","setString","file","create","contents","TextEncoder","encode","createWritable","stream","keepExistingData","write","close","getDir","getDirectoryHandle"],"mappings":"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"}