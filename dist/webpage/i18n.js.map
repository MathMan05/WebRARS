{"version":3,"sources":["../../src/webpage/i18n.ts"],"sourcesContent":["//@ts-ignore\nimport {langs} from \"./translations/langs.js\";\nconst langmap = new Map<string, string>();\nfor (const lang of Object.keys(langs) as string[]) {\n\tlangmap.set(lang, langs[lang]);\n}\nconsole.log(langs);\ntype translation = {\n\t[key: string]: string | translation;\n};\nlet res: () => unknown = () => {};\nclass I18n {\n\tstatic lang: string;\n\tstatic translations: translation[] = [];\n\tstatic done = new Promise<void>((res2, _reject) => {\n\t\tres = res2;\n\t});\n\tstatic async create(lang: string) {\n\t\tconst json = (await (await fetch(\"./translations/\" + lang + \".json\")).json()) as translation;\n\t\tconst translations: translation[] = [];\n\t\ttranslations.push(json);\n\t\tif (lang !== \"en\") {\n\t\t\ttranslations.push((await (await fetch(\"./translations/en.json\")).json()) as translation);\n\t\t}\n\t\tthis.lang = lang;\n\t\tthis.translations = translations;\n\n\t\tres();\n\t}\n\tstatic getTranslation(msg: string, ...params: string[]): string {\n\t\tlet str: string | undefined;\n\t\tconst path = msg.split(\".\");\n\t\tfor (const json of this.translations) {\n\t\t\tlet jsont: string | translation = json;\n\t\t\tfor (const thing of path) {\n\t\t\t\tif (typeof jsont !== \"string\" && jsont !== undefined) {\n\t\t\t\t\tjsont = jsont[thing];\n\t\t\t\t} else {\n\t\t\t\t\tjsont = json;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof jsont === \"string\") {\n\t\t\t\tstr = jsont;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (str) {\n\t\t\treturn this.fillInBlanks(str, params);\n\t\t} else {\n\t\t\tthrow new Error(msg + \" not found\");\n\t\t}\n\t}\n\tstatic fillInBlanks(msg: string, params: string[]): string {\n\t\t//thanks to geotale for the regex\n\t\tmsg = msg.replace(/\\$\\d+/g, (match) => {\n\t\t\tconst number = Number(match.slice(1));\n\t\t\tif (params[number - 1]) {\n\t\t\t\treturn params[number - 1];\n\t\t\t} else {\n\t\t\t\treturn match;\n\t\t\t}\n\t\t});\n\t\tmsg = msg.replace(/{{(.+?)}}/g, (str, match: string) => {\n\t\t\tconst [op, strsSplit] = this.fillInBlanks(match, params).split(\":\");\n\t\t\tconst [first, ...strs] = strsSplit.split(\"|\");\n\t\t\tswitch (op.toUpperCase()) {\n\t\t\t\tcase \"PLURAL\": {\n\t\t\t\t\tconst numb = Number(first);\n\t\t\t\t\tif (numb === 0) {\n\t\t\t\t\t\treturn strs[strs.length - 1];\n\t\t\t\t\t}\n\t\t\t\t\treturn strs[Math.min(strs.length - 1, numb - 1)];\n\t\t\t\t}\n\t\t\t\tcase \"GENDER\": {\n\t\t\t\t\tif (first === \"male\") {\n\t\t\t\t\t\treturn strs[0];\n\t\t\t\t\t} else if (first === \"female\") {\n\t\t\t\t\t\treturn strs[1];\n\t\t\t\t\t} else if (first === \"neutral\") {\n\t\t\t\t\t\tif (strs[2]) {\n\t\t\t\t\t\t\treturn strs[2];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn strs[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn str;\n\t\t});\n\n\t\treturn msg;\n\t}\n\tstatic options() {\n\t\treturn [...langmap.keys()].map((e) => e.replace(\".json\", \"\"));\n\t}\n\tstatic setLanguage(lang: string) {\n\t\tif (this.options().indexOf(userLocale) !== -1) {\n\t\t\tlocalStorage.setItem(\"lang\", lang);\n\t\t\tI18n.create(lang);\n\t\t}\n\t}\n}\nconsole.log(langmap);\nlet userLocale = navigator.language.slice(0, 2) || \"en\";\nif (I18n.options().indexOf(userLocale) === -1) {\n\tuserLocale = \"en\";\n}\nconst storage = localStorage.getItem(\"lang\");\nif (storage) {\n\tuserLocale = storage;\n} else {\n\tlocalStorage.setItem(\"lang\", userLocale);\n}\nI18n.create(userLocale);\nfunction makeWeirdProxy(obj: [string, translation | void] = [\"\", undefined]) {\n\treturn new Proxy(obj, {\n\t\tget: (target, input) => {\n\t\t\tif (target[0] === \"\" && input in I18n) {\n\t\t\t\t//@ts-ignore\n\t\t\t\treturn I18n[input];\n\t\t\t} else if (typeof input === \"string\") {\n\t\t\t\tlet translations = obj[1];\n\n\t\t\t\tif (!translations) {\n\t\t\t\t\t//Really weird way to make sure I get english lol\n\t\t\t\t\ttranslations = I18n.translations[I18n.translations.length - 1];\n\t\t\t\t\tobj[1] = translations;\n\t\t\t\t}\n\t\t\t\tif (!translations) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst value = translations[input];\n\t\t\t\tif (value) {\n\t\t\t\t\tlet path = obj[0];\n\t\t\t\t\tif (path !== \"\") {\n\t\t\t\t\t\tpath += \".\";\n\t\t\t\t\t}\n\t\t\t\t\tpath += input;\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\treturn (...args: string[]) => {\n\t\t\t\t\t\t\treturn I18n.getTranslation(path, ...args);\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn makeWeirdProxy([path, value]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n}\nimport jsonType from \"./../../translations/en.json\";\ntype beforeType = typeof jsonType;\n\ntype DoTheThing<T> = {\n\t[K in keyof T]: T[K] extends string ? (...args: string[]) => string : DoTheThing<T[K]>;\n};\n\nconst proxyClass = makeWeirdProxy() as unknown as typeof I18n & DoTheThing<beforeType>;\nexport {proxyClass as I18n, langmap};\n"],"names":["langs","langmap","Map","lang","Object","keys","set","console","log","res","I18n","translations","done","Promise","res2","_reject","create","json","fetch","push","getTranslation","msg","params","str","path","split","jsont","thing","undefined","fillInBlanks","Error","replace","match","number","Number","slice","op","strsSplit","first","strs","toUpperCase","numb","length","Math","min","options","map","e","setLanguage","indexOf","userLocale","localStorage","setItem","navigator","language","storage","getItem","makeWeirdProxy","obj","Proxy","get","target","input","value","args","proxyClass"],"mappings":"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"}